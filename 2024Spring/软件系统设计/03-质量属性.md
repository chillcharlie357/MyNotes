---
aliases: 
tags: 
categories:
sticky:
thumbnail:
cover: 
excerpt: false
mathjax: true
comment: true
title: 03-质量属性
date:  2024-04-23 14:04
modified:  2024-04-25 10:04
---

# 1. 质量属性

## 1.1. 要素

- 六元素：作为架构设计的输入
	1. 刺激stimulus：外部的变化、输入，发出者可能是人也可能是外部系统
	2. source
	3. 响应response：
	4. measure: 我们会对响应做可以量化的度量
	5. artifact
	6. environment
- 设计决定：
	- 最小单元是tactic
	- 几个tactic可以组合成pattern

## 1.2. 可用性

### 1.2.1. 概述

在两次Failure之间：

![image.png](https://chillcharlie-img.oss-cn-hangzhou.aliyuncs.com/image%2F2024%2F04%2F25%2F10-22-27-3fa32d7c9b3e50f3244c917f315d27cc-20240425102226-752219.png)

Unabaliable(Detect-Repair-Restart)-Avaliable  
MTTR------MTBT

MTTR: mean time to repair  
MTBF: mean time between failures  

提高可以性：降低MTTR,提高MTBT

$$
Ava = \frac{MTBT}{MTBT+MTBF}
$$

### 1.2.2. 保证可用性方法

![image.png](https://chillcharlie-img.oss-cn-hangzhou.aliyuncs.com/image%2F2024%2F04%2F25%2F10-26-26-4700e0c1f4eeecda5b7b0a03139d2c4e-20240425102625-15d799.png)

#### 1.2.2.1. Detect

1. Ping/Echo: Monitor主动给Server询问，Server响应。
	1. 需要应答，带宽利用率更低
2. Heartbeat: Server按照一定频率主动给Monitor发消息。
3. Timestamp:
	- 收到一系列的消息应该在时间上有先后顺序
	- 进行常识的信息的检查，如果和常识不符合那么可能是出现了问题
4. Santity Checking: 如果数据超出合理范围，认为系统出现问题
5. Condition Monitoring: 对运行的环境进行检查，如网络带宽、占用内存等。当环境达到某些阈值时，产生可用性问题的概率较大。
6. Voting: Voter之间不一致，认为系统出现问题。基本上使用奇数个Voter。
	1. Clone: 多个Voter完全一致，只根据结果投票。
	2. Voter实现不同，为了防止组件的实现影响可用性。如果没有发生可用性问题，输入一致，输出也一致。
	3. Voter实现不同，输入也不同，但是输出在合理范围内，也认为系统可用。
7. Exception Delection: 
8. Self-Test

- Ping/Echo和Heartbeat区别：
	1. 始终检测，heartbeat比ping/echo的带宽开销更小  
	2. 偶发请求，不需要时刻保证可用性，请求前ping/echo


#### 1.2.2.2. Recover

优先级：让系统恢复正常状态>组件恢复


1. active redundancy
	1. 所有组件都并行提供服务
2. passive redundancy
	1. 主/副组件
	2. ![image.png](https://chillcharlie-img.oss-cn-hangzhou.aliyuncs.com/image%2F2024%2F04%2F25%2F10-46-24-5d427223ec0ef63efac9ba31a7400ddc-20240425104623-32b5a7.png)
3. spare
4. Exception Handling: 捕获异常，处理。和redundancy配合，主机发生异常后，启动副本。
5. Rollback：按照一定时间间隔，记录系统的正常状态checkpoint，发生意外时可以回滚。
6. Software Upgrade: 软件提供商已经解决了问题
7. Retry: 问题不是系统造成，而是由于环境问题，如网络不稳定，一段时间后retry可能就可用了。
	1. 会设置最大retry次数
8. Ignore faluts behavior: 把有问题的输入屏蔽掉
	1. 白名单，黑名单
9. degradation: 服务水平降级
10. reconfiguration: 系统重新配置。
	1. 基于微服务的系统，每个微服务有众多实例


1. Shadow：之前发生过错误的组件会有一段时间的shadow mode，如果出现问题立刻恢复。
	1. 组件恢复之后有一段监视期，防止再次出现问题。
2. State re-synchronisation
	1. 被动和主动冗余策略要求要恢复的组件在恢复服务之前对其状态进行升级。
3. Escalating restart：扩大重启范围，但先从最小范围开始。只重启出现错误的组件可能无法解决问题。
4. Non-Stop Forwarding：设备发生主备切换时最大程度地减少中断时间


#### 1.2.2.3. Prevent

目的：延长系统正常运行的时间MTBF。

1. Removal from service：把带病工作的组件尽早替换掉
2. Transaction：2pc
3. Predictive Model：使用基于以往数据的概率模型预测
4. Exception Prevention：在异常捕获上提供更高级的处理能力
5. Increase Competence Set：对可能会出现faults的原因进行针对性设计



