---
aliases: 
tags: 
categories:
sticky:
thumbnail:
cover: 
excerpt: false
mathjax: true
comment: true
title: 03-质量属性
date:  2024-04-23 14:04
modified:  2024-04-30 14:04
---

# 1. 需求

# 2. 质量属性

## 2.1. 要素

- 六元素：作为架构设计的输入
	1. 刺激stimulus：外部的变化、输入，发出者可能是人也可能是外部系统
	2. source
	3. 响应response：
	4. measure: 我们会对响应做可以量化的度量
	5. artifact
	6. environment
- 设计决定：
	- 最小单元是tactic
	- 几个tactic可以组合成pattern

## 2.2. 可用性

### 2.2.1. 概述

在两次Failure之间：

![image.png](https://chillcharlie-img.oss-cn-hangzhou.aliyuncs.com/image%2F2024%2F04%2F25%2F10-22-27-3fa32d7c9b3e50f3244c917f315d27cc-20240425102226-752219.png)

Unabaliable(Detect-Repair-Restart)-Avaliable  
MTTR------MTBT

MTTR: mean time to repair  
MTBF: mean time between failures  

提高可以性：降低MTTR,提高MTBT

$$
Ava = \frac{MTBT}{MTBT+MTBF}
$$

### 2.2.2. 可用性策略

![image.png](https://chillcharlie-img.oss-cn-hangzhou.aliyuncs.com/image%2F2024%2F04%2F25%2F10-26-26-4700e0c1f4eeecda5b7b0a03139d2c4e-20240425102625-15d799.png)

#### 2.2.2.1. Detect

1. Ping/Echo: Monitor主动给Server询问，Server响应。
	1. 需要应答，带宽利用率更低
2. Heartbeat: Server按照一定频率主动给Monitor发消息。
3. Timestamp:
	- 收到一系列的消息应该在时间上有先后顺序
	- 进行常识的信息的检查，如果和常识不符合那么可能是出现了问题
4. Santity Checking: 如果数据超出合理范围，认为系统出现问题
5. Condition Monitoring: 对运行的环境进行检查，如网络带宽、占用内存等。当环境达到某些阈值时，产生可用性问题的概率较大。
6. Voting: Voter之间不一致，认为系统出现问题。基本上使用奇数个Voter。
	1. Clone: 多个Voter完全一致，只根据结果投票。
	2. Voter实现不同，为了防止组件的实现影响可用性。如果没有发生可用性问题，输入一致，输出也一致。
	3. Voter实现不同，输入也不同，但是输出在合理范围内，也认为系统可用。
7. Exception Delection: 
8. Self-Test

- Ping/Echo和Heartbeat区别：
	1. 始终检测，heartbeat比ping/echo的带宽开销更小  
	2. 偶发请求，不需要时刻保证可用性，请求前ping/echo

#### 2.2.2.2. Recover

优先级：让系统恢复正常状态>组件恢复

1. active redundancy
	1. 所有组件都并行提供服务
2. passive redundancy
	1. 主/副组件
	2. ![image.png](https://chillcharlie-img.oss-cn-hangzhou.aliyuncs.com/image%2F2024%2F04%2F25%2F10-46-24-5d427223ec0ef63efac9ba31a7400ddc-20240425104623-32b5a7.png)
3. spare
4. Exception Handling: 捕获异常，处理。和redundancy配合，主机发生异常后，启动副本。
5. Rollback：按照一定时间间隔，记录系统的正常状态checkpoint，发生意外时可以回滚。
6. Software Upgrade: 软件提供商已经解决了问题
7. Retry: 问题不是系统造成，而是由于环境问题，如网络不稳定，一段时间后retry可能就可用了。
	1. 会设置最大retry次数
8. Ignore faluts behavior: 把有问题的输入屏蔽掉
	1. 白名单，黑名单
9. degradation: 服务水平降级
10. reconfiguration: 系统重新配置。
	1. 基于微服务的系统，每个微服务有众多实例

11. Shadow：之前发生过错误的组件会有一段时间的shadow mode，如果出现问题立刻恢复。
	1. 组件恢复之后有一段监视期，防止再次出现问题。
12. State re-synchronisation
	1. 被动和主动冗余策略要求要恢复的组件在恢复服务之前对其状态进行升级。
13. Escalating restart：扩大重启范围，但先从最小范围开始。只重启出现错误的组件可能无法解决问题。
14. Non-Stop Forwarding：设备发生主备切换时最大程度地减少中断时间

#### 2.2.2.3. Prevent

目的：延长系统正常运行的时间MTBF。

1. Removal from service：把带病工作的组件尽早替换掉
2. Transaction：2pc
3. Predictive Model：使用基于以往数据的概率模型预测
4. Exception Prevention：在异常捕获上提供更高级的处理能力
5. Increase Competence Set：对可能会出现faults的原因进行针对性设计

## 2.3. 互操作性 Interoperability

### 2.3.1. 概述

- 互操作性：组件和组件之间相互操作，交换数据，都通过interface完成

- 要素
	1. Discovery：服务注册，和哪个对象互操作，怎么查找。
		1. location
		2. identity
		3. interface of service
	2. Handling of response：
		1. reports back to the requester
		2. sends its response on to another system
		3. broadcasts

![image.png](https://chillcharlie-img.oss-cn-hangzhou.aliyuncs.com/image%2F2024%2F04%2F25%2F11-27-23-e24963fb38ef335e5a0929875103ee2d-20240425112722-1f7428.png)  
![image.png](https://chillcharlie-img.oss-cn-hangzhou.aliyuncs.com/image%2F2024%2F04%2F25%2F11-28-49-04751e4f3259e6415b58535b09e68d81-20240425112848-9dce66.png)

### 2.4. 互操作性策略

![image.png](https://chillcharlie-img.oss-cn-hangzhou.aliyuncs.com/image%2F2024%2F04%2F25%2F11-30-18-565bdb570d67ae4e40a0d211c005114a-20240425113017-9a2720.png)

#### 2.4.1. Locate

1. Discover Service：服务要在注册中心注册才能被找到

#### 2.4.2. Manage Interfaces

1. Orchestrate: 工作流编排，通过编排不同服务提供数据交换能力
2. Tailor Interface：在interface上增加和删减一些能力
	1. e.g.区分付费用户和免费用户

## 2.5. 可修改性 Modifiability

### 2.5.1. 概述

设计的时候就要考虑未来的变化。

预先针对变化设计，还是变化发生之后再去修改，取决于成本。

![image.png](https://chillcharlie-img.oss-cn-hangzhou.aliyuncs.com/image%2F2024%2F04%2F25%2F11-39-58-0264100979bdb60ba4f3c304068a8f63-20240425113957-842a8a.png)  
![image.png](https://chillcharlie-img.oss-cn-hangzhou.aliyuncs.com/image%2F2024%2F04%2F25%2F11-40-36-bcbb77559343010d9f84807f5c36d81a-20240425114035-2af04a.png)

### 2.5.2. 可修改性策略

![image.png](https://chillcharlie-img.oss-cn-hangzhou.aliyuncs.com/image%2F2024%2F04%2F25%2F11-42-54-1659105ca675aaf8586ad10d242eaa00-20240425114253-47bd1d.png)

1. Reduce Size of Moudle：减小模块的规模
2. Increase Cohesion：提高内聚
	1. 语义相近的部分往往需要同时修改
3. Reduce Coupling
	1. Encapsulate：封装可能的变化
	2. Use an Intermediary：使用中间件
	3. Restrict Dependencies：使用分层结构简化依赖关系
	4. Refactor：不是针对系统内部重构，是架构层面的重构，把责任放到最合适的地方
	5. Abstract Common Services：把相似的服务放在一起，修改对外参数
4. Defer Binding：推迟绑定时间
	1. 有越多的时间确定关系
	2. 但是也会对其他质量属性造成负面影响

## 性能 Performance

系统满足时间需求的能力

- 决定性能的时间
	1. processing time
	2. blocked time

### 概述

![image.png](https://chillcharlie-img.oss-cn-hangzhou.aliyuncs.com/image%2F2024%2F04%2F30%2F14-05-49-7c9ec4af005d63037d71db0ab770cd75-20240430140546-cb09ff.png)  
![image.png](https://chillcharlie-img.oss-cn-hangzhou.aliyuncs.com/image%2F2024%2F04%2F30%2F14-06-01-e431136370746160356a85aa199757e1-20240430140558-cf1dec.png)

## 性能策略

减少任务  
增加处理能力

![image.png](https://chillcharlie-img.oss-cn-hangzhou.aliyuncs.com/image%2F2024%2F04%2F30%2F14-09-32-65db085871dd299a4e9c055fd3bd4a13-20240430140930-acc202.png)


- demand side
	1. 降低采样频率
	2. 限制事件响应，如果系统来不及响应，把事件放入等待队列
	3. 优先级
	4. 使用中间层，提高资源利用效率
- resource side
	1. 提升资源
	2. 并发
	3. 复制多个实例，使用负载均衡器把任务分配到实例上
	4. 复制多份数据，缓存、数据冗余

## 安全 Security


### 概述

保护系统不被未授权的访问影响

- 特征
	1. Confidentiality：数据和服务不能被未授权访问
	2. Integrity：数据和服务不能被未授权操作
	3. Availability：系统对合法用户可以正常使用

![image.png](https://chillcharlie-img.oss-cn-hangzhou.aliyuncs.com/image%2F2024%2F04%2F30%2F14-31-07-341098559fc7f205a8d7d451575fd08f-20240430143105-c26ce4.png)
![image.png](https://chillcharlie-img.oss-cn-hangzhou.aliyuncs.com/image%2F2024%2F04%2F30%2F14-31-20-8a217de96bc3f58a32aa3a566258e208-20240430143118-a33992.png)
