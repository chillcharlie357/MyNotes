---
aliases: 
tags: 
categories:
sticky:
thumbnail:
cover: 
excerpt: false
mathjax: true
comment: true
title: 05-基本表的物理结构
date:  2024-04-08 14:04
modified:  2024-04-10 10:04
---

密集存储：查询方便  
分散存储：写方便

堆文件

# 1. 数据库具体文件的物理组织形式

**本质都是树**，结构相同、但取值以及不同动态使用算法的树

1. 顺序文件(索引，B+树等)
2. 散列文件（hash）
	- 纯随机，没有顺序
3. 随机文件（堆文件，基本表结构）
4. 聚簇文件（融合性文件）
	- 按照一定程度的顺序

结构优化  
算法优化

# 2. IOT

Index-orginzed Table

记录强制排序

# 3. 数据自动分组(grouping)

- **分区(Partition)** 也是一种数据分组的方式
	- **把逻辑上的一张基本表分到不同的物理文件上，底层是多张物理表**
	- 提高并发性和并行性
	- 从而增强系统架构的伸缩性

- 面对两大问题
	- 管理问题（备份和恢复）
	- 数据量巨大的表，B+树的索引失效，非聚簇索引的大量随机I/O问题
- 策略
	1. 全量扫描数据，不需要任何索引
	2. 热点数据

## 3.1. 循环分区

如滑动窗口

1. 分区定义为各个磁盘的存储区域
2. 可以看作是随意散布数据的机制

## 3.2. 数据驱动分区

- 根据一个或多个字段的值来定义分区
- 实现方式
	1. 哈希分区
	2. 范围分区/键值分区
	3. 列表分区：把记录的某些字段放在某些分区，把热点和非热点分开，每个分区会额外复制主键

## 3.3. 分区表的底层实现原理

分区表由多个相关的底层表实现  
操作时都有一个锁表的过程

## 3.4. 分区的问题

1. NULL值会使分区过滤无效
2. 分区列和索引列不匹配（没有索引，或关联查询时关联条件不匹配索引）
3. 选择分区的成本较高（分区范围的成本需要注意）
4. 打开并锁住所有底层表的成本可能很高
5. 维护分区成本高

6. 如果不走分区键，很容易造成全表锁或多次相同索引查询。
7. 很难实现分区中关联查询。
8. 索引的复制导致更新复杂，分区层锁定问题。
9. 分区表，隐藏复杂，使得工程师不可控。

## 3.5. 数据分区的最佳方法

1. partition key尽量均匀分布
2. partition key不能改动

# 4. 分区、分表、分库

1. 分区
	- 把一张表分成N个区块，逻辑上是一张表，但底层是N个物理区块组成
2. 分表（手搓分区）
	- 把一张表按照一定规则分解成N个具有独立空间的实体表
	- 系统读写时需要根据定义好的规则得到对应的字表明，然后操作它
	- 优势：
		1. 插入数据需要重建的索引减少
		2. 在应用层完成表的选择，读写锁影响的数据量(不用锁住所有表再选择)
	- 问题：
		1. 多张表的事务处理和回滚比一张逻辑表复杂得多
		2. 需要业务系统配合迁移升级，工作量大
3. 分库
	- 解决单个数据节点访问的上限


