# 链路层

![第3讲：局域网数据链路层原理与技术_页面_02](https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/第3讲：局域网数据链路层原理与技术_页面_02.jpg)

## 数据链路层概述

![第3讲：局域网数据链路层原理与技术_页面_03](https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/第3讲：局域网数据链路层原理与技术_页面_03.jpg)

数据链路层data link layer提供了：

- 访问网络媒体
- 跨媒体的物理传输

第二层协议procedure =  protocol定义了：

- 数据传输格式
- 节点行为规范

### 局域网和数据链路层

![第3讲：局域网数据链路层原理与技术_页面_04](https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/第3讲：局域网数据链路层原理与技术_页面_04.jpg)

#### 主要工作

- 错误识别(notification)
- 网络拓扑(Network topology)
- 流控制(Flow control)

| 第一层                                   | 第二层                   |
| ---------------------------------------- | ------------------------ |
| 无法与上层通信                           | 通过LLC与上层通信        |
| 无法确定哪台主机将会传输或接受二进制数据 | 通过MAC确定              |
| 无法命名或标识主机                       | 通过寻址或命名过程来实现 |
| 仅仅能描述比特流                         | 通过帧来组织/分组比特    |



### 提供的服务

![第3讲：局域网数据链路层原理与技术_页面_05](https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/第3讲：局域网数据链路层原理与技术_页面_05.jpg)

1. (最弱，最不靠谱的)没有确认(acknowledgement)的无连接(Connectionless)服务

   发送取出就行，不用等收到确认

   一般用于：

   - 可靠(Reliable)的链接(上层以确保数据正确性)
   - 实时任务，比较高效
   - 适用于**大多数局域网**（局域网比较可靠，一般为本地链接）

2. 带有确认的无连接服务：

   不可靠的链接，例如无线网络：需要保证一定的通信质量(比如无线网络的传输)，同时会损失一定的性能。

3. 带有确认的连接服务

   - 比如蓝牙：需要先确定**绑定关系**才能进行通信
   - 手机和手机之间的蓝牙连接需要确定一些信息

   

### 建立在MAC上的常见局域网

![第3讲：局域网数据链路层原理与技术_页面_06](https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/第3讲：局域网数据链路层原理与技术_页面_06.jpg)

1. 以太网(Ethernet)

   逻辑上，总线拓扑(信息流在线性总线上)

   物理上，星形或扩展星形

2. 令牌环(Token Ring)

   逻辑上，环拓扑(信息流在一个环中)

   物理上，星形拓扑

3. FDDI(光纤分布式数据接口)

   光纤作为传输介质，后被以太网取代

   逻辑上，环拓扑(信息流在一个环中)

   物理上，双环拓扑

### MAC访问方法

![第3讲：局域网数据链路层原理与技术_页面_07](https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/第3讲：局域网数据链路层原理与技术_页面_07.jpg)

确定性轮流Deterministic

​	轮流式的taking turns

​	Token Ring and FDDI(Fiber Distributed Data Interface，光纤分布式数据接口)

​	类似军棋，需要拿到令牌才能出棋

争用式Non-deterministic (probabilistic)

​	非确定性、概率性——先到先得 first come, first sesrved

​	Ethernet/802.3

#### 确定式MAC协议

![第3讲：局域网数据链路层原理与技术_页面_08](https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/第3讲：局域网数据链路层原理与技术_页面_08.jpg)

1. 特殊数据令牌在环中循环(circulates)。
2. 当主机收到令牌时，它可以传输数据而不是令牌。这称为夺取(seizing)令牌。
3. 当发送的帧返回到发送器时，站点将发送新令牌，帧从环上去除或脱落(stripped)。

#### 非确定性MAC协议

![第3讲：局域网数据链路层原理与技术_页面_09](https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/第3讲：局域网数据链路层原理与技术_页面_09.jpg)

1. 此MAC协议称为**带冲突检测的载波侦听多路访问(CSMA/CD，Carrier Sense Multiple Access with Collision Detection)**

2. 为了使用这种共享介质技术，以太网允许网络设备为传输权进行仲裁(arbitrate)。

3. 以太网是一种局域网，是**无确认的无连接服务**。

   **CSMA/CD Carrier Sense Multiple Access with Collision Detection 带冲突检测的载波侦听多路访问**
   载波侦听，确保正确。

### 局域网传输方法

![第3讲：局域网数据链路层原理与技术_页面_10](https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/第3讲：局域网数据链路层原理与技术_页面_10.jpg)

- 单播

  将单个数据包从源发送到网络上的**单个目标**

- 多播

  由发送到网络上**特定节点子集**的单个数据包组成

  这些节点都有同样的进程进行响应

- 广播

  由单个数据包组成，该数据包传输到网络上的**所有节点**。

  广播的目的地址是0x11111111

   

## 以太网和CSMA/CD

### 局域网标准

![第3讲：局域网数据链路层原理与技术_页面_12](https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/第3讲：局域网数据链路层原理与技术_页面_12.jpg)

1. 定义物理层介质和接入设备
2. 在数据链路层定义设备的通信方式
3. 数据链路层定义了如何在物理介质上传输数据。
4. 数据链路层还定义了如何封装特定于协议的流量，以使去往不同上层协议的流量在到达堆栈时可以使用相同的通道。

![第3讲：局域网数据链路层原理与技术_页面_13](https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/第3讲：局域网数据链路层原理与技术_页面_13.jpg)

> IEEE 802.2对应LLC，IEEE802.3对应物理层和MAC，以太网则覆盖物理层和链路层

1. IEEE将数据链路层分为两部分：
   1. 介质访问控制(MAC)(转换到介质)
   2. 逻辑链路控制(LLC)(过渡到网络层)

![第3讲：局域网数据链路层原理与技术_页面_14](https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/第3讲：局域网数据链路层原理与技术_页面_14.jpg)

1. 乍一看，IEEE标准的两种方式都违反了OSI模型。
   1. 首先，它定义自己的层(LLC)，包括其接口等。
   2. 其次，看来MAC层标准802.3和802.5跨越了第2层/第1层接口。
      - 802.5 令牌环网
      - 802.3 覆盖了物理层和第二层下半层
2. 但是，802.3和802.5定义了用于构建特定技术的命名，框架和介质访问控制规则，都规范了对应的方案，不同方案不同解决标准

![第3讲：局域网数据链路层原理与技术_页面_15](https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/第3讲：局域网数据链路层原理与技术_页面_15.jpg)

1. MAC子层(802.3)
   - 定义如何在物理线路上传输帧(frames)
   - 处理物理寻址
   - 定义网络拓扑
   - 定义线路规程
2. LLC 子层(802.2)
   - 逻辑上标识不同的协议类型，然后将其封装，兼容不同介质的访问
   - 使用**SAP**标识符执行逻辑标识，用来做发送的位置的标识
   - LLC帧的类型取决于上层协议期望的标识符，对于上层服务进行支持

### MAC 子层

![第3讲：局域网数据链路层原理与技术_页面_16](https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/第3讲：局域网数据链路层原理与技术_页面_16.jpg)

注意是**字节**不是字

#### 前导码preamble

![第3讲：局域网数据链路层原理与技术_页面_17](https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/第3讲：局域网数据链路层原理与技术_页面_17.jpg)

**前同步码**告诉接收站一帧即将到来，前面7个字节是0x10101010，最后一个是0x10101011(用于进行时钟同步，标志结束)。

使用曼彻斯特编码，0电平的时候无电压。

**不一定全部收到**

#### 目的地址、源地址

![第3讲：局域网数据链路层原理与技术_页面_18](https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/第3讲：局域网数据链路层原理与技术_页面_18.jpg)

先看**目的地址**的好处:交换机等看到目的地址就可以进行判断，提高效率

#### 长度字段

![第3讲：局域网数据链路层原理与技术_页面_19](https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/第3讲：局域网数据链路层原理与技术_页面_19.jpg)

早期这里是长度字段，以太网二用类型取代长度字段。不需要长度参数也可以算出帧的长度。

#### 数据字段

最小的**46**字节，最多1500字节。

**4个64字节大小帧同时发送才能保证占据全部的链路**，100m链路，用512us，就是512bit，也就是64字节。64-（6+6+2+4）=46 。【**前引导码不算帧长度**】

如果没有46，则补零。

#### FCS字段

![第3讲：局域网数据链路层原理与技术_页面_20](https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/第3讲：局域网数据链路层原理与技术_页面_20.jpg)

循环冗余校验(cyclic redundancy check)值——自己补充

固定4字节

### LLC子层

![第3讲：局域网数据链路层原理与技术_页面_21](https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/第3讲：局域网数据链路层原理与技术_页面_21.jpg)

1. 逻辑链路控制(LLC)子层管理单个链路管理设备之间的通信

2. LLC在IEEE 802.2规范中定义，并且同时支持**无连接和面向连接**的服务。

   **可以服务于总线、令牌环**

3. LLC子层允许部分数据链接层独立于现有技术运行,单个LLC子层可以与不同的MAC子层兼容(compatible)。

   

#### 封装

![第3讲：局域网数据链路层原理与技术_页面_22](https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/第3讲：局域网数据链路层原理与技术_页面_22.jpg)

![第3讲：局域网数据链路层原理与技术_页面_23](https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/第3讲：局域网数据链路层原理与技术_页面_23.jpg)

1. LLC获取网络协议数据(数据包，packet)，并添加更多控制信息以帮助将数据包传递到其目的地。

2. 它添加了802.2规范的两个寻址组件，以在每一端标识上层协议：

   - 目标服务访问点(DSAP)
   - 源服务访问点(SSAP)

   基于SAP规范进行地址和分配。

3. 然后，此重新打包的数据将传输到MAC以进一步封装数据。

   

### 介质访问控制

#### MAC地址

![第3讲：局域网数据链路层原理与技术_页面_25](https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/第3讲：局域网数据链路层原理与技术_页面_25.jpg)

1. MAC地址为**48位**，始终表示为**12个十六进制数字**。
2. IEEE管理的前6个十六进制数字(从左到右)标识制造商或销售商(供应商)，并包括**组织唯一标识符(OUI)**。
   - OUI是生产的厂商，比如0060CF就是Cisco的，然后可以使用后面24个bit进行自己的编码
   - 一个厂商是可以买多个OUI的，也可以几个单位买一个OUI
   - 第一个bit取0表示这个地址是一个单播地址，取1则是表示是一个多播地址。
   - 第二个bit取0表示这个地址是全球唯一地址，取1则表示是本地唯一地址
3. 其余的6位十六进制数字包括接口序列号，由特定供应商管理。

#### Ethernet 802.3 广播

![第3讲：局域网数据链路层原理与技术_页面_26](https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/第3讲：局域网数据链路层原理与技术_页面_26.jpg)

1. 广播
   - 目标MAC：全1(FFFF.FFFF.FFFF)
   - 保证所有的设备都能收到这个地址
   - 会导致非目的主机进行地址解析
2. 广播会不必要地打断基站，从而严重影响基站的性能
3. 因此，**仅在以下情况下才应使用广播**：
   - 目的地的MAC地址未知
   - 目的地是所有主机
4. 非必要情况下我们不希望有很多广播，有可能会导致广播风暴，需要严格限制广播的使用

#### 以太网操作

![第3讲：局域网数据链路层原理与技术_页面_27](https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/第3讲：局域网数据链路层原理与技术_页面_27.jpg)

上图中1是**总线拓扑**，1发送的数据帧会传达给所有在这个总线上的设备，非目的主机检查目的地址和本机MAC地址不同，则会将该帧丢弃。

1. **以太网是广播网络**，也就是说，每个站都可以看到所有帧，而不管它们是否是目的地
2. 通过MAC地址判断站点是否为目的地
3. 目标站在OSI层上发送数据。其他节点丢弃帧

![第3讲：局域网数据链路层原理与技术_页面_28](https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/第3讲：局域网数据链路层原理与技术_页面_28.jpg)

1. 听然后传送
2. 广播 jam 信号
   - 是一个32bit的全1的数据帧表示出现了冲突
   - 标准思科认为是所有侦听的设备都会发送
3. 发生碰撞(Collision)
   - 两个设备同时使用链路发送电信号，则会出错。
   - 如果有冲突，则会一直侦听总线，等到空闲则可以组织数据帧发送
   - 仍然存在问题 —— 多台主机同时进行组织数据帧进行发送
   - 因为同时还在侦听总线，如果出现冲突，则会发出jam信号，只要有0或者1传输，有电平则会表示使用
4. 设备退回(back off)适当的时间，然后重新传输(retransmit),发生冲突的设备，根据特定的回退算法

帧至少为64字节，数据部分至少为46字节。

## 以太网 和 带冲突检测的载波侦听多路访问 Ethernet and CSMA/CD

![第3讲：局域网数据链路层原理与技术_页面_29](https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/第3讲：局域网数据链路层原理与技术_页面_29.jpg)



1. 首先设备要发送数据
2. 开始侦听链路是非忙，如果忙，则过一阵来再看看
3. 如果不忙，则开始准备发送
   - 如果有错误，则到9，表示有冲突发送，广播一个jam sighnal，把自己尝试的次数 + 1(重发有一定限度)
   - 尝试次数过多，会像上层协议传输网络不可用
   - 尝试次数还可，则到13计算一个回退时间，来再次尝试，回退时间单位，会保证A和D的时间差能保证第一个人已经用完电路来避免冲突。
4. 如果没有错误，则一直传输到结束为止







什么介质决定用什么网卡

曼彻斯特编码，从低到高或从高到低为0，选取一个方案不冲突即可。

网络接入层 
Internet access layer

### PDU协议数据单元

Protocol Data Unit

在OSI模型系统里，PDU和最底下四层相关。

1. [物理层](https://zh.m.wikipedia.org/wiki/物理层)（一层）PDU指**数据位**（**Bit**）。
2. [数据链路层](https://zh.m.wikipedia.org/wiki/数据链路层)（二层）PDU指**数据帧**（**Frame**）。
3. [网络层](https://zh.m.wikipedia.org/wiki/网络层)（三层）PDU指**数据包**[[注 1\]](https://zh.m.wikipedia.org/zh-hans/协议数据单元#cite_note-1)（**Packet**）或**数据报**（**Datagram**）[[1\]](https://zh.m.wikipedia.org/zh-hans/协议数据单元#cite_note-cf-packet-2)。
4. [传输层](https://zh.m.wikipedia.org/wiki/传输层)（四层）PDU指**数据段**（**Segment**）。

第五层或以上为**数据**（**data**）。

## 无线局域网与CSMA/CA

### 无线局域网

![第3讲：局域网数据链路层原理与技术_页面_31](https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/第3讲：局域网数据链路层原理与技术_页面_31.jpg)

无线局域网

- 基于单元的通信
- 基站发送的信号只能被附近的基站接收
- 短距离传输

无线局域网标准

- IEEE 802.11
- IEEE 802.11b
- IEEE 802.11a
- IEEE 802.11g
- IEEE 802.11n

无线局域网分为两类

1. 有基础设施拓扑网络(Infrastructure mode)
2. 无基础设施拓扑网络(ad-hoc mode)

![第3讲：局域网数据链路层原理与技术_页面_32](https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/第3讲：局域网数据链路层原理与技术_页面_32.jpg)

IEEE 802.11

- 一项关键技术：**直接序列扩频(DSSS，Direct Sequence Spread Spectrum)**
- DSSS适用于在 1 到 2 Mbps范围内运行的无线设备，上面的这个速率在实际生活场景中要除以2，因为无线通信都是有确认的，所以一般我们认为信道一来一回才有一次通信。
- DSSS可以高达11 Mbps的速度运行，但在2 Mbps以上时将不被视为兼容
- 也称为 Wi-Fi™，无线保证度，是星型拓扑，基站作为中心

IEEE 802.11b(Wi-Fi)

- 传输能力提高到11 Mbps（采用高速直连技术，将传输能力提高好几倍）
- 所有802.11b系统都向后兼容(backward compliant)，因为它们还仅针对DSSS支持1和2 Mbps数据速率的802.11。
- 通过使用与802.11不同的编码技术来实现(Achieves)更高的数据吞吐率
- 在2.4 GHz内运行，解决了802.11中出现的部分问题

![第3讲：局域网数据链路层原理与技术_页面_33](https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/第3讲：局域网数据链路层原理与技术_页面_33.jpg)

IEEE 802.11a

- 涵盖在5 GHz传输频带中运行的WLAN设备
- 运行在5GHz上
- 802.11a能够提供54 Mbps的数据吞吐量，并且采用称为"速率加倍"的专有技术已达到108 Mbps。
- 实际上，更标准的等级是20-26 Mbps。
- 传播距离相比802.11和802.11b短，信号衰减厉害，但是对于多用户上网的支持更好了。
- 使用**正交频分复用**技术。

proprietary 所有的，专利的

![第3讲：局域网数据链路层原理与技术_页面_34](https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/第3讲：局域网数据链路层原理与技术_页面_34.jpg)IEEE 802.11g

- 可以提供与802.11a(54Mbps)相同的功能，但具有802.11b的向后兼容性
- 使用**正交频分复用(OFDM，Orthogonal Frequency Division Multiplexing)**技术。

IEEE 802.11n: 下一代的WLAN

- 提供的带宽是802.11g的两倍，即108Mbps，理论上可达500-600Mbps。实际上是100M左右
- 目前使用比较多的方案。

### 无线局域网拓扑

![第3讲：局域网数据链路层原理与技术_页面_35](https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/第3讲：局域网数据链路层原理与技术_页面_35.jpg)

分为infrastructure mode和ad-hoc mode

AP(Access Point)形成**星型拓扑**，基站之间不相互连接，只与AP相连，形成基本服务集BSS

多个AP形成扩展的服务集ESS

#### Infrastructure Mode

![第3讲：局域网数据链路层原理与技术_页面_36](https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/第3讲：局域网数据链路层原理与技术_页面_36.jpg)

1. 基本服务集(BSS)包括一个基站(BS)和几个无线主机

   - 所有主机都可以在本地BSS中直接相互通信
   - 基站中两个主机之间是不直接互相通信的。
   - 同一个BSS中的主机间直接通信

2. 接入点(AP)充当基础架构模式的基站(BS)

   - AP硬连线到有线(cabled)局域网，以提供Internet访问和与有线网络的连接
   - 安装AP后，将分配服务集标识符(SSID)和通道
   - 单元格的范围是91.44至152.4米(300至500英尺)
   - 速率一般约为百兆，覆盖大概100m左右

3. 一个BSS可以通过分发系统(DS)连接到另一个BSS，并构造一个扩展服务集(ESS)。

   

   家里的路由器既有AP的功能又有路由器功能，但是理论上只应该是AP的功能，一般我们认为家用路由器是一个AP

### Accessing Procedure访问过程

![第3讲：局域网数据链路层原理与技术_页面_37](https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/第3讲：局域网数据链路层原理与技术_页面_37.jpg)

1. 在WLAN中激活客户端时，它将开始"侦听"与之"关联"的兼容设备
2. 这被称为"扫描"
   - 主动扫描
   - 被动扫描

### 主动扫描

![第3讲：局域网数据链路层原理与技术_页面_38](https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/第3讲：局域网数据链路层原理与技术_页面_38.jpg)

1. 希望加入网络的无线节点发送探测(probe)请求。
2. 探测请求将包含它希望加入的网络的**服务集标识符**(SSID)
3. 当找到具有相同SSID的AP时，该AP将发出探测响应
4. 身份验证（authentication）和关联步骤已完成
5. 移动端发出请求帧，但是AP不发送自己的信息，AP比较安全。**不用发送出自己的SSID**

#### 被动扫描

![第3讲：局域网数据链路层原理与技术_页面_39](https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/第3讲：局域网数据链路层原理与技术_页面_39.jpg)

1. 侦听由AP（有基础设施拓扑网络）或对等节点(无基础设施拓扑网络)传输的信标管理帧(beacon management frames)，**包含自己的SSID信息**
2. 当节点接收到包含要尝试加入的网络的SSID的信标时，将尝试加入该网络。
3. 被动扫描是一个连续的过程，并且随着信号强度的变化，节点可能会与AP关联或分离，也是因为强度变化，所以**连接状态需要维持**。



### 无线局域网的帧结构

![第3讲：局域网数据链路层原理与技术_页面_40](https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/第3讲：局域网数据链路层原理与技术_页面_40.jpg)

1. WLAN不使用标准的802.3帧。

2. 框架有三种类型

   - 控制帧(Control Frames)
   - 管理帧(Management frames)
   - 数据帧(仅数据帧类似于802.3帧)

3. 无线数据帧和802.3帧的有效载荷(payload)为1500字节

   - 但是，以太帧不能超过1518字节，而无线帧则可能高达**2346字节**。

     是因为在无线情况下使用的是有确认的信息，增加无线帧有效数据大小，来对冲确认的信息的损耗。

   - 通常，WLAN帧大小将被限制为1518字节，因为它最常连接到有线以太网。（有线以太网属于有线局域网，以太帧限制在1518字节）



### 数据帧结构（802.11 WLAN无线局域网）

![第3讲：局域网数据链路层原理与技术_页面_41](https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/第3讲：局域网数据链路层原理与技术_页面_41.jpg)

WEP规格，Wired Equivalent Privacy

有基础设施网络拓扑用地址1、2、3

无基础设施网络拓扑用地址4

#### 数据帧中的地址

![第3讲：局域网数据链路层原理与技术_页面_42](https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/第3讲：局域网数据链路层原理与技术_页面_42.jpg)

扩展星型拓扑

A发往AP，AP发往B

### CSMA/CA

#### 为什么我们需要CSMA/CA

![第3讲：局域网数据链路层原理与技术_页面_43](https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/第3讲：局域网数据链路层原理与技术_页面_43.jpg)

用于**无基站**的情况

冲突(Collisions)可能发生在WLAN无线局域网中，但是站点只能知道附近的传输，因此CSMA/CD不是一个好的选择。【有线局域网是总线模式，可以知道所有的传输】

- 隐藏站问题:当A将数据传输到B时，C无法检测到A和B之间的传输，因此C可能会决定将数据传输到B并导致B发生冲突。
- 暴露站问题:当B将数据传输到A时，C可以检测到传输，因此C不会将数据传输到D。但这是一个错误。

#### 多路复用机制

![第3讲：局域网数据链路层原理与技术_页面_44](https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/第3讲：局域网数据链路层原理与技术_页面_44.jpg)

以太网（有线局域网）

- 信号被传输到电缆上的**所有**站。
- 发送站检测到冲突。
- 一次只能在信道上发送一个有效帧。

WLAN （无线局域网）

- 信号通过电缆传输到发送站附近的站(相邻,不可以跨越有效距离发送)
- MAC协议必须尽最大努力确保只有一个相邻接收基站的发送点
- 由接收基站来确定冲突。
- 多路传输，一次可以在通道上传输**多**个有效(effective)帧

#### CSMA/CA 避免冲突的载波侦听多路访问

![第3讲：局域网数据链路层原理与技术_页面_45](https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/第3讲：局域网数据链路层原理与技术_页面_45.jpg)

CSMA/CA(Carrier Sense Multiple Access with Collision Avoidance)

RTS Request To Send 

CTS Clear To Send

有可能在B处发生冲突，C由于与B较远，未听到CTS，与A同时发送

![第3讲：局域网数据链路层原理与技术_页面_46](https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/第3讲：局域网数据链路层原理与技术_页面_46.jpg)

1. 为避免冲突，802.11所有站点在**完成一个事务后必须等待一段时间**才能进行下一个动作，这个时间被称为**IFS**，具体取决于帧的类型。

2. SIFS(Short interframe space):短帧间间隔 28us，用于本设备接受发送状态转换，不足够源站接受CTS

3. DIFS(Distributed Inter-frame Spacing)：分布协调功能帧间间隔 128us(多个节点进行协调)

4. 应答CTS(Clear to Send)，等待SIFS(Short interframe space)后发送数据

5. 在收到ACK之后，一次通讯结束

6. 过程中的时间写入帧的**时间数据标记位**

7. NAV(网络分配向量)：网络协调时间，时间长度；

   NAV计算方式在后面，NAV是一开始就进行预估了，别的节点抢到了节点时，我们会减掉别人正常通信的时间，不是一直累积下去的情况。

8. 这次通讯结束，下一次经过争用窗口来抢

9. 源站需要收到确认信息CTS才能接着发送信息

10. 多个源站向目的站发RTS给目的站，目的站发现冲突，告诉各自站点，PPT处理的是RTS

#### CSMA/CA实例

![第3讲：局域网数据链路层原理与技术_页面_47](https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/第3讲：局域网数据链路层原理与技术_页面_47.jpg)



#### 实际数据传输率

![第3讲：局域网数据链路层原理与技术_页面_48](https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/第3讲：局域网数据链路层原理与技术_页面_48.jpg)

1. 当源节点发送帧时，接收节点将返回肯定**确认(ACK)**。
   - 这可能导致消耗50％的可用带宽(bandwidth)。
   - 在额定为11 Mbps的802.11b无线局域网上，这会将实际数据吞吐量降低到最大5.0到5.5Mbps。
2. 网络性能也会受到信号强度的影响
   - 随着信号变弱，可以调用**自适应速率选择(ARS)**
   - 信号会受到距离影响，越远信号越弱，功率越低，带宽不能稳定到初始带宽
   - 传输单元会将数据速率从11 Mbps降低到5.5Mbps，从5.5 Mbps降低到2 Mbps或2 Mbps到1 Mbps。

### WLAN和Ethernet区别

| Ethernet                             | WLAN                                          |
| ------------------------------------ | --------------------------------------------- |
| 信号被传输到连接在线缆上的所有站点上 | 信号只被传输到接近发送站点的站点              |
|                                      | 接受站点检测冲突                              |
| 只会有一个有效帧在信道上传播         | 会有多个有效帧同时在信道上传播                |
|                                      | MAC协议必须尽可能保证只有发送站点接近接收站点 |

## 第二层设备

### NICs网卡

![第3讲：局域网数据链路层原理与技术_页面_50](https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/第3讲：局域网数据链路层原理与技术_页面_50.jpg)

NIC执行重要的第2层数据链路层功能：

1. 逻辑链接控制-与计算机上层通信
2. 媒体访问控制-提供对共享访问媒体的结构化访问
3. 命名-提供唯一的MAC地址标识符
4. 成帧-封装过程的一部分，打包比特以进行传输。
5. 发信号-使用内置收发器创建信号并与媒体接口(也有第一层功能，01序列变成信号发出去)

### Bridges网桥

![第3讲：局域网数据链路层原理与技术_页面_51](https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/第3讲：局域网数据链路层原理与技术_页面_51.jpg)

1. 网桥将流量划分为多个部分，并根据MAC地址而不是协议对流量进行过滤。

2. 网桥可以通过减少较大的冲突域来提高网络性能。

3. 在从网络的一个网段到其他网段的流量较低的情况下，网桥最有效。

   当网段之间的流量变大时，网桥会成为瓶颈(bottleneck)，并减慢通信速度。(网桥将数据帧检验存储再转发)

#### 透明网桥

![第3讲：局域网数据链路层原理与技术_页面_52](https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/第3讲：局域网数据链路层原理与技术_页面_52.jpg)

1. Mac表放到缓存的位置，刚启动时是空表，之后在发送中逐渐学习。
   - Mac地址表是有生命周期的，如果计时超过一个阈值没有刺激刷新Mac表，则会刷新表
   - 比如笔记本更换接入地址。
2. "**透明**"指局域网中的站点并不知道所发送的帧将经过哪几个网桥，因为网桥对各站来说是看不见的
3. 原理
   1. 从A发出的帧从接口x进入了网桥，则从这个接口发出帧就一定能达到A。网桥每收到一个帧，就记下其源地址和进入网桥的接口，写入转发表。
   2. 在收到一个新的帧时，在转发表中匹配此帧的目的地址，找到对应的接口并转发。
   3. 在网桥的转发表中写入的信息除了地址和接口外，还有帧进入网桥的时间，因为
      - 拓扑可能经常变化
      - 站点也可能会更换适配器(这就改变了站点的地址)
      - 站点并非总是处于工作状态
      - 把每个帧到达网桥的时间登记下来，就可以在转发表中只保留网络拓扑的最新状态信息，使得网桥中的转发表能反映当前网络的最新拓扑

![第3讲：局域网数据链路层原理与技术_页面_53](https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/第3讲：局域网数据链路层原理与技术_页面_53.jpg)

1. 问题：网络上的设备要发送数据但不知道目标地址时。
   - 向网络上的所有设备发送**广播**。因为希望数据帧能够发送到全网，尽可能到达目的地
   - 由于网络上的每个设备都必须注意此类广播，因此**网桥始终会转发这些广播**。
2. 广播过多会导致**广播风暴**，并且可能导致：
   - 网络延时(network time-outs)
   - 交通减速(traffic slowdowns)
   - 低于可接受的性能

#### 源路由网桥

1. 发送帧时将详细的路由信息放在帧的首部中,从而使每个经过的网桥都了解帧的路径
2. 在令牌环网络中被广泛使用
3. 原理——源站以广播方式向目的站发送一个发现帧，每个发现帧都记录所经过的路由。发现帧到达目的站时就沿各自的路由返回源站。源站在得知这些路由后，从所有可能的路由中选择出一个最佳路由。凡从该源站向该目的站发送的帧的首部，都必须携带源站所确定的这一路由信息。

### Switches

![第3讲：局域网数据链路层原理与技术_页面_54](https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/第3讲：局域网数据链路层原理与技术_页面_54.jpg)

执行两个基本操作：

1. 帧交换：在输入介质(medium)上接收帧，然后将其传输到输出介质
2. 维护交换操作：交换器建立和维护交换表并搜索回路。路由器构建并维护路由表和交换表。(STP协议避免回路)

![第3讲：局域网数据链路层原理与技术_页面_55](https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/第3讲：局域网数据链路层原理与技术_页面_55.jpg)

交换机可以分离冲突域。

交换是一项通过减少流量和提高带宽来缓解以太网LAN拥塞(alleviates congestion)的技术.

1. 交换机创建专用(dedicated)的网段或点对点连接，并将这些网段连接到交换机内的虚拟网络中。
2. 之所以称为**虚拟电路**，是因为它仅在两个端口需要通信时才存在，并且在交换机内建立。网桥内部有一个高带宽的总线(一般内部母线带宽是端口带宽的10倍)
3. 您可以将每个交换机端口视为一个微桥(micro-bridge)。该过程称为微分段(microsegmentation)。
4. 每个交换机端口将介质的全部带宽提供给每个主机

![第3讲：局域网数据链路层原理与技术_页面_56](https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/第3讲：局域网数据链路层原理与技术_页面_56.jpg)

局域网交换机可减少冲突域的大小

但是，连接到交换机的所有主机仍位于同一广播域中。

1. 也就是说，通过LAN交换机连接的所有其他节点仍将看到来自一个节点的广播。
2. **交换机不能划分广播域**(端口->所有端口转发)

交换机连接的是一个局域网，而路由器连接的是不同局域网。

#### 交换机划分冲突域

![第3讲：局域网数据链路层原理与技术_页面_57](https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/第3讲：局域网数据链路层原理与技术_页面_57.jpg)

1. 转发的速度明显加快，因为它们在**硬件**中进行切换，而网桥在**软件**中进行切换。

2. 可以使用交换机连接10 Mbps以太网LAN 和 100 Mbps以太网LAN。

3. 在交换式以太网实现中，可用带宽可以接近100％。

4. 共享以太网网络的容量不足其全部容量的30％至40％时，其性能最佳。

5. 一些交换机支持直通交换，这减少了延迟和延迟，而网桥仅支持存储转发交换(存储转发，存下来检验转发)

   **直通交换**:快速转发，不做校验，只看前6字节的MAC地址（目的地址）。局域网下，网速比较快，传输速率高，网线比较短，可以认为是基本没有错误的，所以可以进行直通转发

### 路由器分割广播域和冲突域

![第3讲：局域网数据链路层原理与技术_页面_58](https://quasdo.oss-cn-hangzhou.aliyuncs.com/img/第3讲：局域网数据链路层原理与技术_页面_58.jpg)

1. 路由器可以创建最高级别的细分：
   1. 创建较小的**碰撞域**
   2. 创建较小的**广播域**：除非经过编程，否则路由器不会转发广播。
2. 路由器通过检查数据包上的**目标逻辑地址**，然后在其路由表中查找转发指令来完成数据包的转发
3. 由于路由器比网桥执行更多的功能，因此它们以更高的延迟率运行。
4. 路由器可以用作**网关**，用于连接不同的网络媒体和不同的LAN技术
5. 是根据逻辑地址(**IP地址**)进行转发，不再是MAC

**路由器可以分割广播域**





### 访问控制

Service Set Identifier(SSID)

主动扫描，较为安全，不用发送SSID

被动扫描，存在安全隐患，会潜在SSID

### 无线局域网帧结构（有考试要求）

以太帧不能超过1518字节，而无线帧则可能高达**2346字节**。

[帧结构](https://blog.csdn.net/engineer_james/article/details/102625324)

持续期——告诉周边节点正在发送，避免发生冲突

## 第二层设备

### NIC网卡

**网络接口控制器**（英语：network interface controller，NIC）

是一块被设计用来允许计算机在计算机网络上进行通讯的计算机硬件。

### 网桥

#### 透明网桥

缓存是RAM，从开始时是空表，到逐渐学习记录。

#### 源路由网桥



ROM —— Read-Only Memory

　　只读储存器 ，对于电脑来讲就是硬盘，对于手机来讲就是内置储存，对于单片机来讲就是Flash。用于存放操作系统的软件。ROM可以在掉电的情况下，依然保存原有的数据。

RAM —— Random-Access Memory

　　随机储存器 ，就是电脑的内存条。用于存放动态数据。(也叫运行内存)系统运行的时候，需要把操作系统从ROM中读取出来，放在RAM中运行。RAM为随机存储，掉电不会保存数据

### 交换机

可以划分冲突域，但是不能够隔绝广播域。

交换机连接的是一个局域网，而路由器连接的是不同局域网。



一些交换机**支持直通交换**，这减少了延迟和延迟，而网桥仅支持**存储转发交换(存储转发，存下来检验转发)**。

1. 直通交换:快速转发，不做校验，只看前6字节的MAC地址。
2. 局域网:网速比较快，传输速率高，网线比较短，可以认为是基本没有错误的，所以可以进行直通转发



SDN 只用交换机做控制，不用路由器做控制。



