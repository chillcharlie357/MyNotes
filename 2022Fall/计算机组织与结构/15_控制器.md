# 1. 处理器结构

![90_VoIPSCreencastCoverWnd.png](https://chillcharlie-img.oss-cn-hangzhou.aliyuncs.com/imgae/2023/02/07/a629116d035cda973654584f1669caa9_90_VoIPSCreencastCoverWnd.png)


# 2. 寄存器

## 2.1. 用户可见寄存器
- user-visible register
	- 允许编程人员通过机器语言或汇编语言访问，通过优化寄存器的使用而减少对主存的访问

### 2.1.1. 类型
1. 通用寄存器（general-purpose register）
	- 可被程序员指派各种用途
2. 数据寄存器（data register）
	- 仅可用于保持数据而不能用于操作数地址的计算
3. 地址寄存器（address register）
	- 可以是自身有某些通用性，或是专用于某种具体的寻址方式
	- 例如：段指针、变址寄存器、栈指针
4. 条件码寄存器（condition codes register） / 标志（flag）寄存器
	- CPU硬件设置这些条件位作为操作的结果
	- 至少是部分用户可见的

### 2.1.2. 设计出发点
1. 使用完全通用的寄存器还是规定各寄存器的用途？
2. 寄存器数量
	- 太少的寄存器会导致更多的存储器访问
	- 太多的寄存器又不能显著地减少存储器访问
3. 寄存器长度
	- 应能保存大多数数据类型的值
	- 某些机器允许两个相邻的寄存器作为一个寄存器来保持两倍长度 的值


### 2.1.3. 保存和恢复
- 子程序调用
	- 会导致自动保存所有用户可见的寄存器，并在返回时自动取回
	- 这些保存和恢复是作为调用和返回指令执行功能的一部分，由CPU完成
	- 允许各个子程序独立地使用用户可见寄存器
- 子程序调用之外保存用户可见寄存器的相关内容是程序员的责任，需要在程序中为此编写专门的指令


## 2.2. 控制和状态寄存器
### 2.2.1. 类型
1. 程序计数器（Program counter，PC）
	- 存有待取指令的地址
	- 通常在每次取指令之后，PC的内容即被CPU更改，转移或跳步指令也会修改PC的内容，因此总指向将被执行的下一条指令
2. 指令寄存器（Instruction register，IR）
	- 存有最近取来的指令，在其中分析操作码和操作数
3. 存储器地址寄存器（Memory address register，MAR）
	- 直接与地址总线相连，存有存储器位置的地址
4. 存储器缓冲寄存器（Memory buffer register，MBR）
	- 直接与数据总线相连，存有将被写入存储器的数据字或从存储器读出的字，用户可见寄存器再与MBR交换数据
	- ALU可对MBR和用户可见寄存器直接存取
5. 程序状态字（Program status word，PSW）
	-  一个或一组包含状态信息的寄存器，包含条件码加上其他状态信息
	- 包含的字段或标志
		- 符号（Sign）：容纳算术运算结果的符号位
		- 零（Zero）：当结果是0时被置位
		- 进位（Carry）：若操作导致最高位有向上的进位（加法）或借位（减法）时被置位，用于多字算数运算
		- 等于（Equal）：若逻辑比较的结果相等，则置位
		- 溢出（Overflow）：用于表示算术溢出
		- 中断允许/禁止：用于允许或禁止中断
		- 监管（Supervisor）：指出CPU是执行在监管模式中还是在用户模式中
6. 一个指向含有附加状态信息的存储器块的指针寄存器
7. 在使用向量式中断的机器中，可能提供有一个中断向量寄存器
8. 若栈用于实现某些功能，需要有一个系统栈指针
9. 对于虚拟存储器系统，会有一个页表指针寄存器

### 2.2.2. 设计出发点
1. 设计出发点
	- 某些类型的控制信息是专门为操作系统使用的
	- 若CPU设计者对将要使用的操作系统有基本的了解，则寄存器 的组织可能在一定程度上为该操作系统定制
2. 控制信息在寄存器和存储器之间的分配
	- 一种普遍的做法是将存储器最前面（最低地址）的几百或几千个字用于控制目的
	- 在成本和速度之间进行权衡

# 3. 微操作
- 定义：执行程序时，计算机操作是由一系列指令周期组成，每个周期执 行一条机器指令。每个指令周期又可以看作是由几个更小的子周期组成。每个子周期由一系列涉及**CPU寄存器操作**的更小步骤组成，这些步骤称为**微操作**
![91_VoIPSCreencastCoverWnd.png](https://chillcharlie-img.oss-cn-hangzhou.aliyuncs.com/imgae/2023/02/07/c058c702798dee245234c233231682c6_91_VoIPSCreencastCoverWnd.png)
## 3.1. 微操作分组的原则
- 事件的流动顺序必须是恰当的
	- 例：MAR <- (PC) 必须先于MBR <- 内存，因为内存读操作要使用 MAR中的地址
- 必须避免冲突
	- 例：MBR <- 内存 和IR <- MBR 这两个微操作不应出现在同一时间 单位里
- 满足上述条件下，所用的时间单位尽可能少

## 3.2. 取指周期

- 出现在每个指令周期的开始，将指令从存储器中取出
- 过程：
![92_VoIPSCreencastCoverWnd.png](https://chillcharlie-img.oss-cn-hangzhou.aliyuncs.com/imgae/2023/02/07/57836ed7b8c3e2aba7a8644205814750_92_VoIPSCreencastCoverWnd.png)


## 3.3. 间址周期

- 如果指令采用间接寻址，则在指令执行前有一个间址周期
- 完成间址周期后，IR的状态与不使用间接寻址方式的状态是 相同的，已经为执行周期准备就绪
- 过程：![93_VoIPSCreencastCoverWnd.png](https://chillcharlie-img.oss-cn-hangzhou.aliyuncs.com/imgae/2023/02/07/6c4d70bd6df5beb35e78f85aaa74fb6b_93_VoIPSCreencastCoverWnd.png)

## 3.4. 执行周期
- 对于不同的操作码，会出现不同的微操作序列
- 例子
	- 加法指令![94_VoIPSCreencastCoverWnd.png](https://chillcharlie-img.oss-cn-hangzhou.aliyuncs.com/imgae/2023/02/07/b8cb22423d8cbfea9ddbacb8fbaf6861_94_VoIPSCreencastCoverWnd.png)

	- “转移并保存地址”指令![95_VoIPSCreencastCoverWnd.png](https://chillcharlie-img.oss-cn-hangzhou.aliyuncs.com/imgae/2023/02/07/35b0bd8a280dfb87eaf8adce99c3b54a_95_VoIPSCreencastCoverWnd.png)

## 中断周期

- 在完成执行周期时，要确定是否有允许的中断产生
- 如果有，则出现一个中断周期
- 过程：![96_VoIPSCreencastCoverWnd.png](https://chillcharlie-img.oss-cn-hangzhou.aliyuncs.com/imgae/2023/02/07/c7a671b141c6af5a0273f705d6723127_96_VoIPSCreencastCoverWnd.png)


# 指令周期代码
