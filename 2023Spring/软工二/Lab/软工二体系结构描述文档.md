# 1. 引言

完成订票系统第一阶段的软件体系结构描述文档，重点描述系统整体的逻辑视角（逻辑包图）、物理视角（物理包图）、开发视角（部署图），包含系统**所有用例**。关于模块的设计，主要描述组成视角、接口视角和数据视角。重点描述**库存模块和销售模块**的相关类的设计。必须包含库存模块和销售模块;.的业务逻辑层的接口规范和数据层的接口规范，和数据库设计。

# 2. 小组成员

| 姓名 | 学号 |   
| ------ | --------- | 
| 何乐阳 | 211250138 | 
| 王政和 | 211250114 |  
| 徐子豪 | 211250110 | 
| 沈扬 | 211250112 | 

# 3. 逻辑视角

在l23o6铁路购票系统中，采用了四层体系结构风格。系统分为展示层(presentation)，控制层(controller，控制前后端交互)，服务层(service，实现业务逻辑)以及数据层(完成数据的持久化，实现与数据的访问与交互)。分层体系结构如下图所示。

![](https://njuse2.oss-cn-hangzhou.aliyuncs.com/image/2023/06/04/848616389d93be6c676c8db63acd0c31_848616389d93be6c676c8db63acd0c31_202306042219380.png)


# 4. 组合视角

## 4.1. 开发包图

表示软件组件在开发时环境中的静态组织架构，这部分简要描述了开发包，包之间的相互依赖关系并绘制了开发包图。

### 4.1.1. 前端包图

```SCSS
|---- App.vue
|---- components
|     |---- LoginForm.vue
|     |---- MenuComponent.vue
|     |---- RegisterForm.vue
|     |---- RouteDetailForm.vue
|     |---- Title.vue
|     |---- TrainManageDetail.vue
|     |---- TrainManageForm.vue
|     `---- UserInfoComponent.vue
|---- components.d.ts
|---- composables
|     |---- dark.ts
|     `---- index.ts
|---- config.ts
|---- env.d.ts
|---- main.ts
|---- pages
|     |---- index.vue
|     |---- login.vue
|     |---- register.vue
|     |---- route.vue
|     |---- station.vue
|     |---- train.vue
|     `---- user.vue
|---- stores
|     |---- search.ts
|     |---- stations.ts
|     `---- user.ts
|---- styles
|     |---- element
|     |     |---- dark.scss
|     |     `---- index.scss
|     `-- index.scss
`---- utils
      |-- date.ts
      `-- request.ts
```

|   |   |
|---|---|
|开发（物理）包|依赖的其他开发包|
|stores|对应的controller|
|utils|/ 封装了工具类|
|pages|components|
|components|composables|
|train|router,trainManageDetial, useStationStore,TrainManageForm, useStationsStore|
|station|useStationsStore|
|route|useStationsStore|
|register|/|
|login|/|
|index|/|



### 4.1.2. 后端包图

```Shell
|---- L23o6Application.java
|---- controller
|     |---- BusinessExceptionHandler.java
|     |---- HelloController.java
|     |---- RouteController.java
|     |---- StationController.java
|     |---- TrainController.java
|     `---- UserController.java
|---- dao
|     |---- OrderDao.java
|     |---- RouteDao.java
|     |---- StationDao.java
|     |---- TrainDao.java
|     `---- UserDao.java
|---- enum_
|   `---- order
|       `---- OrderStatus.java
|---- exception
|     `---- BizError.java
|---- mapper
|     |---- RouteMapper.java
|     |---- StationMapper.java
|     |---- TrainMapper.java
|     `---- UserMapper.java
|---- pojo
|     |---- entity
|     |     |---- OrderEntity.java
|     |     |---- RouteEntity.java
|     |     |---- StationEntity.java
|     |     |---- TrainEntity.java
|     |     `---- UserEntity.java
|     `---- vo
|       |---- PagedResult.java
|       |---- route
|       |     |---- AddRouteRequest.java
|       |     `---- RouteVO.java
|       |---- station
|       |     |---- AddStationRequest.java
|       |     `---- StationVO.java
|       |---- train
|       |     |---- AddTrainRequest.java
|       |     |---- AdminTrainVO.java
|       |     |---- ListTrainRequest.java
|       |     |---- TicketInfo.java
|       |     |---- TrainDetailVO.java
|       |     `---- TrainVO.java
|       `---- user
|             |---- EditUserInfoRequest.java
|             |---- LoginRequest.java
|             |---- RegisterRequest.java
|             `---- UserVO.java
`---- service
      |---- RouteService.java
      |---- StationService.java
      |---- TrainService.java
      |---- UserService.java
      `---- impl
          |---- RouteServiceImpl.java
          |---- StationServiceImpl.java
          |---- TrainServiceImpl.java
          `---- UserServiceImpl.java
```

|   |   |
|---|---|
|开发（物理）包|依赖的其他开发包|
|controller|对应的service|
|mapper|Entity,dao|
|exception|/|
|eunm.order|/|
|dao|/|
|pojo.entity|/|
|pojo.vo.route|/|
|pojo.vo.station|/|
|pojo.vo.train|/|
|pojo.vo.user|/|
|routeservice|routeEntity,routeVo,routeMapper|
|stationservice|stationEntity,stationVo,stationMapper|
|trainservice|trainEntity,trainVo,trainMapper|
|userservice|userEntity,userVo,userMapper|

  ![UML 图](https://njuse2.oss-cn-hangzhou.aliyuncs.com/image/2023/06/04/d6a4d965199a24404dc5a92d01d84575_UML%20%E5%9B%BE.jpg)

## 4.2. 运行时进程

示意图:
![](https://njuse2.oss-cn-hangzhou.aliyuncs.com/image/2023/06/04/11bee4f9fdd1fc95fd16b11dc54b777e_11bee4f9fdd1fc95fd16b11dc54b777e_asynccode.png)

## 4.3. 物理部署

![](https://njuse2.oss-cn-hangzhou.aliyuncs.com/image/2023/06/04/b39b6286ec362b31a91e6128df670d34_b39b6286ec362b31a91e6128df670d34_asynccode.png)

# 5. 接口视角

## 5.1. 模块职责

客户端模块视图:
![](https://njuse2.oss-cn-hangzhou.aliyuncs.com/image/2023/06/04/c2b47e164c5467a5b857705e57259531_c2b47e164c5467a5b857705e57259531_202306042221209.png)

服务端模块视图:
![](https://njuse2.oss-cn-hangzhou.aliyuncs.com/image/2023/06/04/8d92c313a476f14e41d5baae694cbee9_8d92c313a476f14e41d5baae694cbee9_202306042221495.png)

1. 客户端各层职责

|   |   |
|---|---|
|层|职责|
|启动模块|负责初始化⽹络通信机制，启动⽤户界⾯|
|用户界面层|l23o6浏览器端用户界面，使用Vue.js框架实现|
|客户端网络模块|使⽤RESTful⻛格接⼝通过HTTP请求实现前后端通信|

2. 服务端各层职责

|   |   |
|---|---|
|层|职责|
|启动模块|负责初始化网络通信机制，启动用户界面|
|业务逻辑层|对于前端的请求进行响应并进行业务逻辑处理|
|数据层|负责数据的持久化以及数据访问接口|
|网络模块|通过RESTfulAPI接口处理前端发出的请求|

3. 层之间调用接口

|   |   |   |
|---|---|---|
|接口|服务调用方|服务提供方|
|RESTfulAPI|客户端展示层|服务端控制层|
|RouteService<br><br>StationService<br><br>TrainService<br><br>UserService|服务端控制层|服务端业务逻辑层|
|RouteMapper<br><br>StationMapper<br><br>TrainMapper<br><br>UserMapper|服务端业务逻辑层|服务端数据层|


## 5.2. 用户界面分离

- 用户界面包含：
    
    - 铁路信息界面
        
    - 注册界面
        
    - 登陆界面
        
    - 车次管理界面
        
    - 路线管理界面
        
    - 路线查询界面
        
    - 添加路线界面
        
    - 车站管理界面
        
    - 主页
        

界面跳转:
![界面跳转](https://njuse2.oss-cn-hangzhou.aliyuncs.com/image/2023/06/04/6138b75935b0bd0499e1b0bb27d0ccae_6138b75935b0bd0499e1b0bb27d0ccae_202306042221926.png)


### 5.2.1. 职责

|   |   |
|---|---|
|模块|职责|
|RouteController|负责路线管理界面相关|
|StationController|负责车站管理界面相关|
|TrainController|负责车次管理界面相关|
|UserController|负责用户登陆注册界面相关|

### 5.2.2. 接口规范

#### 5.2.2.1. RouteController模块

##### 5.2.2.1.1. 接口规范

|   |   |   |   |
|---|---|---|---|
|接口名称|语法|前置条件|后置条件|
|RouteController.addRoute|addRoute(AddRouteRequest request)|输入有效|添加路线|
|RouteController.getRoutes|getRoutes()|无|获取全部路线信息|
|RouteController.getRoute|getRoute(Long routeId)|无|获取预期路线信息|
|RouteController.editRoute|editRoute(Long routeId, AddRouteRequest request)|输入有效|修改预期路线信息|

##### 5.2.2.1.2. 服务接口

|   |   |
|---|---|
|服务名|服务|
| RouteService.addRoute(String name, List<\Long> stationIds) | 向RouteMapper添加路线|
| RouteService.listRoutes()|从RouteMapper获取所有路线信息|
|RouteService.getRoute(Long id)|从RouteMapper获取预期路线信息|
|RouteService.editRoute(Long id, String name, List<\Long> stationIds)|在RouteMapper中修改预期车票信息|

#### 5.2.2.2. StationController模块

##### 5.2.2.2.1. 接口规范

|   |   |   |   |
|---|---|---|---|
|接口名称|语法|前置条件|后置条件|
|StationController.listStations|listStations()|无|从stationService返回所有车站信息|
|StationController.getStation|getStation(Long stationId)|无|从stationService返回预期车站信息|
|StationController.addStation|addStation(AddStationRequest request)|输入有效|向stationService添加车站信息|
|StationController.editStation|editStation( Long stationId, AddStationRequest request)|输入有效|让stationService修改车站信息|

##### 5.2.2.2.2. 服务接口

|   |   |
|---|---|
|服务名|服务|
|StationService.getStation(Long stationId)|从StationMapper获取预期车站信息|
|StationService.listStations()|从StationMapper获取所有车站信息并排序|
|StationService.addStation(String name)|添加车站|
|StationService.editStation(Long stationId, String name)|修改车站信息|

#### 5.2.2.3. TrainController模块

##### 5.2.2.3.1. 接口规范

|   |   |   |   |
|---|---|---|---|
|接口名称|语法|前置条件|后置条件|
|TrainController.listTrains|listTrains(_ListTrainRequest request_)|输入有效|从trainService获取预期列车信息列表|
|TrainController.getTrain|getTrain(_Long trainId_)|无|从trainService获取预期哦列车信息|
|TrainController.addTrain|addTrain(_AddTrainRequest request_)|输入有效|向trainService添加列车信息|
|TrainController.listTrainsAdmin|listTrainsAdmin()|无|从trainService获取列车管理员列表|
|TrainController.getTrainAdmin|getTrainAdmin(_Long trainId_)|输入有效|从trainService获取预期列车管理员|

##### 5.2.2.3.2. 服务接口

|   |   |
|---|---|
|服务名|服务|
|TrainService.getTrain(_Long trainId_)|从TrainMapper获取预期列车信息|
|TrainService.listTrains(_Long startStationId_, _Long endStationId_, _String date_)|从TrainMapper获取预期列车信息列表|
|TrainService.listTrainsAdmin()|从TrainMapper获取列车管理员列表|
|TrainService.addTrain(_String name_, _Long routeId_, _String type_, _String date_, _List_<_Date_> _arrivalTimes_, _List_<_Date_> _departureTimes_)|向TrainMapper添加列车信息|

#### 5.2.2.4. UserController模块

##### 5.2.2.4.1. 接口规范

|   |   |   |   |
|---|---|---|---|
|接口名称|语法|前置条件|后置条件|
|UserController.login|login(_LoginRequest request_)|输入有效|返回登录状态|
|UserController.register|register(_RegisterRequest request_)|输入有效|使用userService注册新用户|
|UserController.logout|logout()|无|退出登录|
|UserController.userInfo|userInfo()|无|获取用户信息|
|UserController.editInfo|editInfo(_EditUserInfoRequest request_)|输入有效|修改用户信息|

##### 5.2.2.4.2. 服务接口

|   |   |
|---|---|
|服务名|服务|
|UserService.login(_String username_, _String password_)|登录|
|UserService.register(_String username_, _String password_, _String name_, _String idn_, _String phone_, _String type_)|注册新用户|
|UserService.findByUserName(_String username_)|根据用户名查找用户|
|UserService.editInfo(_String username_, _String name_, _String idn_, _String phone_, _String type_)|修改用户信息|

### 5.2.3. 用户界面模块设计原理

使用`vue.js`框架。

## 5.3. 数据层分离

### 5.3.1. 职责

|   |   |
|---|---|
|模块|职责|
|RouteMapper|持久化数据库的接⼝。提供线路信息订单的集体载⼊、集体保存、增、删、<br><br>改、查服务。|
|StationMapper|持久化数据库的接⼝。提供车站信息的集体载⼊、集体保存、增、删、<br><br>改、查服务。|
|TrainMapper|持久化数据库的接⼝。提供列车信息的集体载⼊、集体保存、增、删、<br><br>改、查服务。|
|UserMapper|持久化数据库的接⼝。提供用户信息的集体载⼊、集体保存、增、删、<br><br>改、查服务。|


![](https://njuse2.oss-cn-hangzhou.aliyuncs.com/image/2023/06/04/8ca7e6a6b76c9aa21829a2701bd4a078_202306042306720.png)
# 6. 信息视角

- 配置一个 **Postgresql 数据库。**
    
- 包`pojo`中的`entity`相关对象进行持久化存储数据，在此只做简单的介绍。
    

## 6.1. 数据持久化对象

### 6.1.1. OrderEntity

- 车票订单信息：包含订单id、用户id、列车id、起点站、终点站、订单状态、座位、订单创建时间和订单更新时间。
    

|   |   |   |
|---|---|---|
|属性|定义|类型|
|id|订单号|Long|
|trainId|列车号|Long|
|userId|用户id|Long|
|departureStationId|起点站|Long|
|arrivalStationId|终点站|Long|
|status|订单状态|OrderStatus|
|seat|座位号|String|
|createdAt|车票订单创建时间|Date|
|updatedAt|订单最后更新时间|Date|

### 6.1.2. RouteEntity

- 路线信息
    

|   |   |   |
|---|---|---|
|属性|定义|类型|
|id|路线编号|Long|
|name|路线名称|String|
|stationIds|路线编号列表|List<\Long>|
| createdAt | 路线创建日期 | Date |
| updatedAt  | 路线最后修改日期 | Date |

### 6.1.3. StationEntity

- 车站信息
    

|   |   |   |
|---|---|---|
|属性|定义|类型|
|id|车站编号|Long|
|name|车站名|String|
|createdAt|创建日期|Date|
|updatedAt|最后修改日期|Date|

### 6.1.4. TrainEntity

- 列车信息
    

#### 6.1.4.1. `inner class : TranType`

- 枚举类
    
- 关键字：`HIGH_SPEED("高铁"),` `NORMAL_SPEED("普通列车")`
    

|   |   |   |
|---|---|---|
|属性|定义|类型|
|text|火车类型|String|

类定义如下：

```Java
public enum TrainType {
    HIGH_SPEED("高铁"), NORMAL_SPEED("普通列车");

    private String text;

    TrainType(String text) {
        this.text = text;
    }

    public String getText() {
        return this.text;
    }

    public static TrainType fromString(String text) {
        for (TrainType b : TrainType.values()) {
            if (b.text.equalsIgnoreCase(text)) {
                return b;
            }
        }
        return null;
    }
}
```

#### 6.1.4.2. 属性

|   |   |   |
|---|---|---|
|属性|定义|类型|
|id|列车编号|Long|
|name|列车名称|String|
|routeId|路线编号|Long|
|seats|座位是否有人|boolean[][]|
|trainType|列车类型|TrainType|
|date|发车日期|String|
|arrivalTimes|达到时间集合|List<\Date>|
|departureTimes|出发时间集合|List<\Date>|
|extraInfos|额外信息|List<\String>|
|createdAt|创建时间|Date|
|updatedAt|最后修改时间|Date|

### 6.1.5. UserEntity

- 用户信息
    

|   |   |   |
|---|---|---|
|属性|定义|类型|
|username|用户名|String|
|password|密码|String|
|name|用户昵称|String|
|phone|注册手机号|String|
|type|用户类型|String|
|idn|用户编号|String|
|createdAt|创建时间|Date|
|updatedAt|最后更新时间|Date|

持久化对象UserEntity的定义如下：

```Java
public class UserEntity {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @NotNull
    @Column(unique = true)
    private String username;
    @NotNull
    private String password;

    private String name;
    private String phone;
    private String type;
    private String idn;

    @CreationTimestamp
    private Date createdAt;

    @UpdateTimestamp
    private Date updatedAt;
}
```

## 6.2. 持久化格式

使用关系型数据库postsql存储。持久化对象entity类与数据库中的字段保持一致。

## 6.3. 数据库表

|           |
| --------- |
| 数据库表  |
| Order表   |
| Route表   |
| Station表 |
| Train表   |
| User表    |

