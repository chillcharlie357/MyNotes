
语法分析部分最困难:解析表达式

# 二义性文法

## 悬空else

![](https://chillcharlie-img.oss-cn-hangzhou.aliyuncs.com/imgae/2023/03/30/01c23871cda729ab37d9aa0fba96e416_202303301459442.png)

- 二义性例子:
```c
if a then if b then c else d
```


### 解决

- 解决:实现就近匹配(<font color="#ff0000">antlr4默认</font>)
![](https://chillcharlie-img.oss-cn-hangzhou.aliyuncs.com/imgae/2023/03/30/8de80a1a9ea5c24b9df221b65b2f2077_202303301459923.png)

## 运算符的结合性

<font color="#ff0000">antlr4默认左结合</font>，且按照从上到下的顺序定义优先级。
越早展开，优先级就越低，在语法树上的位置就越靠近根节点。
但是一些上古时代的工具无法处理该文法。

![[Pasted image 20230330150240.png]]
```c
1-2-3
```

- 前缀、后缀计算符只能左结合，不需要考虑结合性

### 解决

- 解决：左递归（左结合）
	- 在最左边调用自己

如果增加新的运算符，则需要相应的增加语法单元，很繁琐
![](https://chillcharlie-img.oss-cn-hangzhou.aliyuncs.com/imgae/2023/03/30/7a999e0ffd35d2437a499f27b3424f02_202303301514512.png)
其中expr->(((t - t) - t) - t)...
			term-> f * f * f ...


# 语法分析实例

## 函数调用图

- Function Call Graph
- 利用antlr4分析函数调用图,分析函数调用关系


多个参数分隔符分开 `formalPara (',' formalpara)*`


## 计算器

`calc`

## 监听器模式(Listener)
[Fetching Title#1mqa](https://www.geeksforgeeks.org/visitor-design-pattern/)

- 限制: 返回值都是`void`
- 解决: 
	- 标注语法分析树
	- 换成`Visitor`模式

### 标注语法分析树

Antlr4提供
hashmap: 语法树node与标注


## 访问者模式(Visitor)

需要自己写语法树遍历过程

1. 相关方法都放在一个类里
2. 增加新的方法只需要创建新的类

**双重分派**

参考书籍->设计模式,图解设计模式


# 上下文敏感文法


# 上下文无关文法
CFG


上下文无关文法$G$是一个四元组$G=(T,N,S,P)$
- $T$是终结符号的集合,对应词法分析器的词法单元
- $N$非终结符号集合


## 推导

最左推导:每次都选则最左边的非终结符