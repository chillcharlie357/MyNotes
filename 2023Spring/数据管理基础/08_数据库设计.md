# 数据库设计方法

E-R图
面向对象的数据库设计方法

- 数据字典：数据项，数据结构，数据流，数据存储的描述

# 设计步骤


# E-R图

[[02_数据模型#2. 概念模型]]

- 要素
	- 实体型：用矩形表示，矩形框内写明实体名。
	- 属性：用椭圆形表示，并用无向边将其与相应的实体型连接起来。
	- 联系：用菱形表示，菱形框内写明联系名，并用无向边分别与有关实体型连接起来，同时在无向边旁标上联系的类型（1∶1，1∶n或m∶n）。

联系可以具有属性


扩展的E-R模型
## ISA联系
- 表示父类-子类联系
- 性质：子类继承了父类所有属性，还有自己的属性

### 分类属性

- 分类属性父实体型的一个属性
- 分类属性的值把父实体型中的实体分派到子实体型中

分类属性说明一个学生是本科生还是研究生
![](https://chillcharlie-img.oss-cn-hangzhou.aliyuncs.com/imgae/2023/04/11/8c044ccb1c90e31c7eefc8b0750750e7_202304111444272.png)
### 不相交约束与可重叠约束

- 不相交约束：一个父类中的实体最多属于一个子类实体集。
	- ISA联系符号有X
- 可重叠约束:父类中的一个实体能同时属于多个子类中的实体集。子类符号中没有叉号表示是可重叠的。


排他空间成本高，可重成本低

### 完备性约束

- 描述父类中的一个实体是否必须是某一个子类中的实体。
	- 是，完全特化（total specialization）
		- 双线表示
	- 否，部分特化( partial specialization)
		- 单线表示

完全特化：父类中所有的实体都具有分类属性，一定是子类的一种


### 基数约束

- 对实体之间一对一、 一对多、多对多联系的细化。说明实体型中的任何一个实体可以在联系中出现的最少次数和最多次数。
- 格式：`<min>..<max>`,`*`表示无穷大

- 下限
	- `min=1`:强制参与约束，即被施加基数约束的实体型中的每个实体都要参与联系;
	- `min=0`:非强制参与约束，被施加基数约束的实体型中的实体可以出现在联系中，也可以不出现在联系.


## Part-of联系

- 非独占联系
	- 整体实体如果被破坏，另一部分实体仍然可以独立存在
	- 非强制参与联系表示非独占的Part-of联系（min=0）
	- eg:汽车拥有轮胎，汽车坏了轮子没事
- 独占联系
	- 整体实体如果被破坏，部分实体不能存在
	- 用**弱实体类型**(双矩形)和**识别联系**（双灵性）来表示独占联系编号编号

删除贷款记录，还款记录级联删除->弱实体类型
建筑拆除，房间也没了->弱类型
把汽车销毁，轮子还留着->强实体类型

# 概念结构设计

为了简化而E-R图的处置，现实世界的事物能作为属性对待的尽量作为属性对待

- 属性的条件
	- 

- 实体与属性划分
	- 学生证：实体




## E-R图集成

- 冲突:各个子系统的E-R图有不一致的地方

### 冲突

#### 属性冲突


#### 命名冲突

#### 结构冲突

- 同一对象在不同应用中具有不同的抽象（一些是实体，一些是属性）。
	- 把属性变换为实体或把实体变换为属性，使同一对象具有相同的抽象。但仍然要遵循实体与属性的划分原则。
- 同一实体在不同子系统的E-R图中所包含的属性个数和属性排列次序不完全相同。
	- 取各子系统E-R图中属性的并集，再适当调整属性的次序。
- 实体间的联系在不同的E-R图中为不同的类型。
	- 一般场景替换特殊场景

![](https://chillcharlie-img.oss-cn-hangzhou.aliyuncs.com/imgae/2023/04/13/1c7c12a23d24802d6d897af87caad133_202304131625145.png)
型一样，但是值不一样，描述的不是同一个东西

## 消除冗余

- 冗余数据:可由基本数据导出的数据。
- 冗余联系:可由其他联系导出的联系。

可以根据数据相关性消除冗余，去掉不提供信息量的数据。
适当冗余数据和联系可以提高效率。
可以使用规范化理论消除冗余。

- 如图7.26中，Q3=Q1×Q2，Q4=∑Q5。所以Q3和Q4是冗余数据，可以消去。并且由于Q3消去，产品与材料间m:n的冗余联系也应消去。

![](https://chillcharlie-img.oss-cn-hangzhou.aliyuncs.com/imgae/2023/04/13/6dbe9b991ff714ba42f0cfeb31012bb5_202304131630724.png)


### 规范化理论消除冗余

[[09_关系数据理论]]

# 逻辑模型设计

目标：把概念设计阶段的E-R图转换成逻辑模型

## 转换原则

## 关系数据模型的优化

- 确定数据依赖
	- 按需求分析阶段所得到的语义，分别写出每个关系模式内部各属性之间的数据依赖以及不同关系模式属性之间数据依赖。
- 并不是规范化程度越高的关系就越优


## 关系模式分解

- 数据操作效率
- 存储空间的利用率


### 水平分解

- 把(基本)关系的**元组**分为若干子集合，定义每个子集合为一个子关系。

例子：把经常使用的20%数据水平分解出来，形成一个子关系


### 垂直分解

出发点是<font color="#ff0000">优化查</font>，而不是增删改。也不是根据范式优化。

- 把关系模式R的**属性**分解为若干子集合，形成若干子关系模式。
- 原则：经常在一起使用的属性从R中分解出来形成一个子关系模式


# 物理模型设计

为给定的逻辑模型选取最合适的物理结构（内模式），在这个阶段正确性已经得到保证，主要关注性能。

## 内容和方法

1. 准备工作
	- 应用环境
	- 了解内部特征：数据库系统支持什么
2. 物理设计的内容
	 -  存取非那个发
	 - 索引、设计关系扥存储结构
3. 所需参数
	 -  数据库查询事务
	 - 数据库更新事务


## 存取方法选择

