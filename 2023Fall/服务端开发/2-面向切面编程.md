---
aliases: 
tags: 
categories:
sticky:
thumbnail:
cover: 
excerpt: false
mathjax: true
comment: true
title: 2-é¢å‘åˆ‡é¢ç¼–ç¨‹
date:  Thursday,September 21st 2023
modified:  Thursday,September 28th 2023
---

# 1. è½¯ä»¶ç¼–ç¨‹æ–¹æ³•

- é¢å‘è¿‡ç¨‹ç¼–ç¨‹ POP
- é¢å‘å¯¹è±¡ç¼–ç¨‹ OOP
- é¢å‘åˆ‡é¢ç¼–ç¨‹ AOP
- å‡½æ•°å¼ç¼–ç¨‹ FP
- ååº”å¼ç¼–ç¨‹ RP

# 2. AOP: Aspect Oriented Programming

## 2.1. æ¨ªåˆ‡å…³æ³¨ç‚¹ğŸ‘

![image.png](https://chillcharlie-img.oss-cn-hangzhou.aliyuncs.com/image%2F2023%2F09%2F21%2F593c95764eb4ced35052b11e904cb58c_20230921200636.png)

### 2.1.1. å®šä¹‰

- æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼šå…¬å…±æ€§çš„åŠŸèƒ½ï¼Œä½†éœ€è¦åµŒå…¥åˆ°ä¸šåŠ¡ä»£ç çš„è®¸å¤šåœ°æ–¹
	- Cross-cutting concern
	- ä¾‹ï¼šæ¥äº†ä¸€ä¸ªè¯·æ±‚ï¼Œéœ€è¦æƒé™è®¤è¯ã€‚æƒé™è®¤è¯ä¸ä¸šåŠ¡é€»è¾‘æ— å…³ï¼Œä¸”è®¸å¤šåœ°æ–¹è¦ç”¨åˆ°ã€‚

Springä¼šå¸®å¼€å‘è€…åµŒå…¥æ¨ªåˆ‡å…³æ³¨ç‚¹

### 2.1.2. ç±»å‹

1. æ—¥å¿—
2. å®‰å…¨
3. äº‹åŠ¡
4. ç¼“å­˜

## 2.2. AOPçš„å¯é€‰æ–¹æ¡ˆ

ä»¥æ—¥å¿—ä¸ºä¾‹

- ç»§æ‰¿
	- è®©ä¸šåŠ¡ç±»ç»§æ‰¿æ—¥å¿—ç±»
	- ç¼ºç‚¹ï¼šå¯¹ä¸šåŠ¡ä»£ç é€ æˆäº†ä¾µå…¥
- å§”æ‰˜
	- å§”æ‰˜æ—¥å¿—å¯¹è±¡çš„å¼•ç”¨æ¥è°ƒç”¨æ—¥å¿—æ–¹æ³•
	- ç¼ºç‚¹ï¼šéœ€è¦çŸ¥é“æ—¥å¿—æ¨¡å—çš„å­˜åœ¨ï¼Œä¾µå…¥ä¸šåŠ¡ä»£ç 

# 3. AOPæœ¯è¯­ğŸ‘

1. **é€šçŸ¥ Advice**ï¼šåˆ‡é¢è¦åšä»€ä¹ˆä»¥åŠä½•æ—¶åš
	- æ—¶é—´ï¼šæ–¹æ³•å‰/å...
2. **åˆ‡ç‚¹ Pointcut**ï¼šä½•å¤„
	- Springåªæ”¯æŒåœ¨<font color="#ff0000">æ–¹æ³•</font>çš„å‰ååˆ‡
	- å†™**åˆ‡ç‚¹è¡¨è¾¾å¼**æŒ‡å®š
3. **åˆ‡é¢ Aspect**ï¼šAdviceå’ŒPointcutçš„ç»“åˆ
	- åŒ…å«åˆ‡çš„æ‰€æœ‰é€»è¾‘
4. **è¿æ¥ç‚¹ Join point**ï¼šæ–¹æ³•ã€å­—æ®µä¿®æ”¹ã€æ„é€ æ–¹æ³•
5. **å¼•å…¥ introduction**ï¼šå¼•å…¥æ–°çš„è¡Œä¸ºå’ŒçŠ¶æ€
	- ç»™å¯¹è±¡åŠ å…¥æ–°çš„æ–¹æ³•/çŠ¶æ€ï¼Œä½†ä¸éœ€è¦å®ç°æ–°çš„å­ç±»ã€‚åœ¨åŸæ¥çš„å¯¹è±¡ä¸ŠåŠ¨æ€åŠ å…¥æ–°çš„æ–¹æ³•/çŠ¶æ€ã€‚
6. **ç»‡å…¥ Weaving**ï¼šåˆ‡é¢åº”ç”¨åˆ°ç›®æ ‡å¯¹è±¡çš„è¿‡ç¨‹

## 3.1. é€šçŸ¥ï¼ˆAdviceï¼‰

**åœ¨aspectç±»çš„æ–¹æ³•ä¸Šæ³¨è§£**

- @Before
- @Afterï¼šä¸åŒºåˆ†æ˜¯å¦æ­£å¸¸ç»“æŸ
- @AfterReturning
- @AfterThrowing
- @Aroundï¼šç»“åˆå‰é¢æ‰€æœ‰ç±»å‹

## 3.2. åˆ‡ç‚¹ Pointcut

- `@Pointcut`ï¼Œç©ºæ–¹æ³•
- å¯ä»¥åœ¨ä¸åŒçš„Adviceçš„åˆ‡ç‚¹è¡¨è¾¾å¼ä¸­ç›´æ¥é‡ç”¨
	- æ¶ˆé™¤é‡å¤
	- **ä¸æ˜¯æ–¹æ³•è°ƒç”¨**

![image.png](https://chillcharlie-img.oss-cn-hangzhou.aliyuncs.com/image%2F2023%2F09%2F21%2Fe5eb3eb6b02f362f0bdf531c29a71c55_20230921201543.png)

## 3.3. åˆ‡é¢ AspectğŸ‘

- ç±»ä¸ŠåŠ `@Aspect`æ³¨è§£
- åŒ…å«åˆ‡çš„æ—¶é—´ã€åˆ‡ç‚¹å’Œé€»è¾‘
- æ˜¯ä¸€ä¸ªå•ç‹¬çš„ç±»

==ä¸éœ€è¦ä¿®æ”¹ä¸šåŠ¡ä»£ç ==

### 3.3.1. åˆ›å»ºæ­¥éª¤

1. å®ç°ä¸€ä¸ªjavaç±»ï¼Œåœ¨ç±»ä¸ŠåŠ `@Aspect`æ³¨è§£ï¼Œå®šä¹‰é€»è¾‘å’Œè¡Œä¸ºã€‚ç”¨`@Before`ç­‰æ³¨è§£å®šä¹‰Adviceå’Œ**åˆ‡ç‚¹è¡¨è¾¾å¼**ã€‚
2. åœ¨é…ç½®ç±»å¢åŠ æ³¨è§£`@EnableAspectJProxy`
3. åˆ›å»ºåˆ‡é¢ç±»å¯¹åº”çš„Bean

### 3.3.2. åˆ‡ç‚¹è¡¨è¾¾å¼/åˆ‡ç‚¹æŒ‡ç¤ºå™¨ğŸ‘

1. å€ŸåŠ©`AspectJ`åˆ‡ç‚¹æŒ‡ç¤ºå™¨çš„è¯­æ³•
2. åœ¨æ–¹æ³•ä¸ŠåŠ `@Before(<åˆ‡ç‚¹è¡¨è¾¾å¼>)`ã€`@Pointercut(<expression)`

#### 3.3.2.1. `Pointcut

`

```java
@Pointcut(
"execution(* soundsystem.CompactDisc.playTrack( int )) " + 
"&& args(trackNumber)") //è·å–å‚æ•°
&& within(soundsystem.*)	//é™å®šåŒ…è·¯å¾„
&& bean(sgtPeppers)	//é™å®šbeanåç§°ï¼Œæˆ–è€…ï¼š && !bean(sgtPeppers)
```

1. æŒ‡å®šæ–¹æ³•`execution`
2. å¯ä»¥æŒ‡å®šåŒ…/è·¯å¾„`within`
3. å¯ä»¥å¸¦å‚æ•°`args`
4. é™å®šåœ¨å“ªäº›Beanä¸Šæ¤å…¥ï¼ˆå¯ä»¥å–åï¼‰`bean`

#### 3.3.2.2. `Around`

1. `@annotation`å…³é”®å­—æŒ‡å®š**åœ¨ç‰¹å®šæ³¨è§£ä¸Šæ¤å…¥**
	- æ³¨è§£å¯ä»¥è‡ªå·±å®šä¹‰ï¼Œå’ŒSpringæ— å…³

- `Around`
	- éœ€è¦ä¸€ä¸ª**ProceedingJoinPointæ–¹æ³•å‚æ•°**
	- å¯¹ProceedingJoinPointæ–¹æ³•çš„è°ƒç”¨å®é™…ä¸Šå°±æ˜¯å¯¹åˆ‡ç‚¹çš„è°ƒç”¨

```java
@Around("@annotation(innerAuth)") //
é™å®šæ³¨è§£
public Object innerAround(ProceedingJoinPoint point, InnerAuth innerAuth) { ... }

@InnerAuth
public R<Boolean> register(@RequestBody SysUser sysUser){...}
```

- Aroundä¼˜åŠ¿
	- å¯ä»¥è‡ªç”±æ§åˆ¶æ˜¯å¦è°ƒç”¨/è°ƒç”¨æ¬¡æ•°
	- å¯ä»¥æœ‰è¿”å›å€¼ï¼Œçµæ´»æ€§æ›´é«˜

### 3.3.3. å®ç°åŸç†

- åˆ‡ä¸ä¸åˆ‡é€šè¿‡`getBean`è·å¾—çš„å¯¹è±¡ç±»å‹å¹¶ä¸ä¸€æ ·ã€‚
- é€šè¿‡åˆ›å»º**ä»£ç†**å®ç°
	- JDKæœ¬èº«å°±å…·å¤‡ä»£ç†èƒ½åŠ›
	- é’ˆå¯¹è¯¥å¯¹è±¡çš„è°ƒç”¨éƒ½ä¼šè½¬åˆ°ä»£ç†å¯¹è±¡

![image.png](https://chillcharlie-img.oss-cn-hangzhou.aliyuncs.com/image%2F2023%2F09%2F21%2F0e23d5f342f4383c7a76122ca75ea479_20230921200101.png)

## 3.4. ç»‡å…¥ Weaving

åŠ¨æ€ç»™å¯¹è±¡å¢åŠ æ–°çš„è¡Œä¸ºï¼Œä¸ç”¨ç»§æ‰¿å­ç±»ã€‚  
èƒŒåçš„å®ç°æ–¹å¼è¿˜æ˜¯ä»£ç†ã€‚

### 3.4.1. ç»‡å…¥æ–¹å¼

1. åˆ›å»ºéœ€è¦å¢åŠ çš„æ¥å£å’Œå®ç°ç±»
2. æ–°å»ºä¸€ä¸ªåˆ‡é¢ç±»ï¼ŒåŠ `@Aspect`
3. åœ¨é‡Œé¢å®šä¹‰ä¸€ä¸ª`static`æ¥å£ï¼ŒåŠ ä¸Š`@DeclareParents`æ³¨è§£
4. æ³¨å†Œåˆ‡é¢ç±»Bean

### 3.4.2. ç»‡å…¥æ—¶æœº

1. ç¼–è¯‘å™¨
2. ç±»åŠ è½½å™¨
3. **è¿è¡ŒæœŸ**


## 3.5. å¼•å…¥ introduction

- `@DeclareParents`
- `main`å’Œæµ‹è¯•

![image.png](https://chillcharlie-img.oss-cn-hangzhou.aliyuncs.com/image%2F2023%2F09%2F21%2Ff76b26d26ccfff3dcc22e9fd080b07ea_20230921211603.png)


![image.png](https://chillcharlie-img.oss-cn-hangzhou.aliyuncs.com/image%2F2023%2F09%2F28%2F786a0319e1f1f5d0d8e5422f97265926_20230928185355.png)
