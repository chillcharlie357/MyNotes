# 由Dockerfile构建镜像

![image.png](https://chillcharlie-img.oss-cn-hangzhou.aliyuncs.com/image%2F2023%2F12%2F21%2F18-48-00-e370271f15d63a6c253c9948ac97824b-20231221184759-c0bcd1.png)

## 文件指令

- FROM：**指定基础镜像，必须为第一个命令**
- RUN：构建镜像时执行的命令
- ADD：将本地文件添加到容器中，**tar类型文件会自动解压**
- COPY：功能类似ADD，但是**不会自动解压文件**
- CMD：**构建容器后调用，也就是在容器启动时才进行调用**
- ENTRYPOINT：配置容器，使其可执行化。配合CMD可省去“application”，只使用参数，用于docker run时根据不同参数执行不同功能
	- 很可能是shell脚本
- LABEL：用于为镜像添加元数据
	- key-value
- ENV：设置环境变量
- EXPOSE：指定与外界交互的端口，容器内的端口号，docker run时加-P则会映射一个随机号（宿主机）
- VOLUME：用于指定持久化目录，docker run时如果没有指定挂载目录，会创建一个volume
- WORKDIR：工作目录，类似于cd命令
- USER：指定运行容器时的用户名或 UID
	- 默认root
- ARG：用于指定传递给构建运行时的变量
- ONBUILD：用于设置镜像触发器
	- 可以被其他人进一步构建，会触发一些行为

## 构建命令

- 生成镜像：`docker build -t  <image>:<tag> .`
	- 最后一个参数context: .

 Dockerfile的每一条命令都是一层，重复构建时有cache，只从修改的层开始重新构建
 