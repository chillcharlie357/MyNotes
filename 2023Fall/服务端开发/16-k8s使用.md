---
aliases: 
tags: 
categories:
sticky:
thumbnail:
cover: 
excerpt: false
mathjax: true
comment: true
title: 16-k8sä½¿ç”¨
date:  Thursday,December 28th 2023
modified:  Thursday,December 28th 2023
---

# k8sç¯å¢ƒ

## å®‰è£…

[GitHub - AliyunContainerService/k8s-for-docker-desktop: ä¸ºDocker Desktop for Mac/Windowså¼€å¯Kuberneteså’ŒIstioã€‚](https://github.com/AliyunContainerService/k8s-for-docker-desktop)

æ ¹æ®è¯´æ˜å®‰è£…

## éƒ¨ç½²dashboard

`kubectl apply -f kubernetes-dashboard.yaml`

kubectlï¼š å®¢æˆ·ç«¯ç¨‹åºä¸è¿œç¨‹k8s serveräº¤äº’  
kubectl proxyï¼š æŠŠè¿œç¨‹k8s serverç«¯å£ä»£ç†åˆ°æœ¬åœ°ç«¯å£

## éƒ¨ç½²ingress controller

`kubectl apply -f ingress-nginx-controller.yaml`

## éªŒè¯ Kubernetes é›†ç¾¤çŠ¶æ€

 - kubectl cluster-info
 - kubectl get nodes
 - kubectl get nodes --show-labels
 - ç»™èŠ‚ç‚¹æ‰“æ ‡ç­¾ï¼škubectl label node docker-desktop disktype=ssd
	 - æŸ¥è¯¢æ»¡è¶³æ ‡ç­¾çš„èŠ‚ç‚¹ï¼škubectl get nodes -l disktype=ssd
	 - åˆ é™¤æ ‡ç­¾ï¼škubectl label node docker-desktop disktype

# k8såŸºæœ¬æ¶æ„

![image.png](https://chillcharlie-img.oss-cn-hangzhou.aliyuncs.com/image%2F2023%2F12%2F28%2F18-55-11-2838e48395432e6ee0c51d6f1cbf08d5-20231228185510-36573e.png)

Node: å®‰è£…dockerçš„å®¿ä¸»æœºï¼Œæä¾›å®¹å™¨ã€‚  
Masterï¼šç®¡ç†é›†ç¾¤çš„æœºå™¨ï¼Œå®‰è£…k8sçš„æ ¸å¿ƒæ¨¡å—ã€‚ä¹Ÿå¯ä»¥ä¸Nodeéƒ¨ç½²åœ¨åŒä¸€å°å®¿ä¸»æœºä¸Šã€‚

kubeletï¼šå’ŒMasterã€æœ¬åœ°dockeräº¤äº’ã€‚  
flannelï¼šå®¹å™¨ç½‘ç»œçš„ç¬¬ä¸‰æ–¹å®ç°ï¼Œç»™å®¹å™¨æä¾›è™šæ‹Ÿç½‘ç»œã€‚  
etcdï¼šç±»ä¼¼reddisçš„ç¼“å­˜ç³»ç»Ÿã€‚

k8sç›®çš„ï¼šé€šè¿‡å¤šä¸ªNodeèŠ‚ç‚¹ï¼Œè·å¾—æ›´å¤šå®¹å™¨ã€‚

# k8sèµ„æºğŸ‘

- namespaces
	- ç±»ä¼¼javaä¸­çš„package
	- å¯ä»¥æŠŠä¸åŒèµ„æºæ”¾åœ¨ä¸åŒnamespaceé‡Œï¼Œä¸åŒnamespaceé‡Œé¢å¯ä»¥æœ‰åŒåèµ„æº
- ReplicaSet
- Pods
	- ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ï¼Œå†…éƒ¨å®¹å™¨çš„é€»è¾‘å®¿ä¸»æœº
	- k8sé‡Œç®¡ç†çš„æœ€å°èµ„æº
- Deployment
	- è´Ÿè´£Podçš„è‡ªåŠ¨åˆ›å»º
- Service
	- ç±»ä¼¼å¾®æœåŠ¡çš„â€œæœåŠ¡â€æ¦‚å¿µï¼Œä¸ºå¤–ç•Œæä¾›ä¸€å®šçš„ä¸šåŠ¡èƒ½åŠ›
	- éƒ¨ç½²åœ¨Podä¸­ï¼Œä¸€ä¸ªæœåŠ¡å¯ä»¥æœ‰å¤šä¸ªPod
- Ingress
	- ç½‘å…³ï¼ŒæŠŠä¸åŒåŸŸå/urlè·¯ç”±åˆ°å¯¹åº”çš„æœåŠ¡
	- k8så¯¹å¤–ç»Ÿä¸€æä¾›Ingressçš„å…¥å£
- configmap
	- é›†ç¾¤ä¸­æä¾›é…ç½®ä¿¡æ¯çš„åœ°æ–¹
	- key-valueç»“æ„
- secrets
	- æ¶‰åŠå®‰å…¨çš„éšç§æ•°æ®ï¼Œæœ‰ä¸åŒç±»åˆ«
- serviceaccounts
	- ç»™å®¹å™¨é‡Œçš„è½¯ä»¶ç”¨çš„è´¦æˆ·ï¼Œå®¹å™¨å’Œk8s serveräº¤äº’æ—¶ç”¨åˆ°
- DaemonSet
	- å¸¸é©»åœ¨Nodeä¸Š
	- ä¾‹ï¼šfluentdï¼Œå¸¸é©»çš„Nodeä¸Šæ”¶é›†æ—¥å¿—

## Pod

- Podæ˜¯Kubernetesè°ƒåº¦çš„æœ€å°å•å…ƒ
- å¤šä¸ªå®¹å™¨åœ¨ä¸€ä¸ªPodä¸­å…±äº«ç½‘ç»œå’Œæ–‡ä»¶ç³»ç»Ÿ
	- PIDå‘½åç©ºé—´ï¼šPodä¸­ä¸åŒçš„åº”ç”¨ç¨‹åºå¯ä»¥çœ‹åˆ°å…¶ä»–åº”ç”¨ç¨‹åºçš„è¿›ç¨‹ID
	- networkå‘½åç©ºé—´ï¼šPodä¸­å¤šä¸ªå®¹å™¨å¤„äº**åŒä¸€ä¸ªç½‘ç»œå‘½åç©ºé—´**ï¼Œå› æ­¤èƒ½å¤Ÿè®¿é—®çš„IPå’Œç«¯å£èŒƒå›´éƒ½æ˜¯ç›¸åŒçš„ã€‚ä¹Ÿå¯ä»¥é€šè¿‡localhostç›¸äº’è®¿é—®
	- IPCå‘½åç©ºé—´ï¼šPodä¸­çš„**å¤šä¸ªå®¹å™¨**å…±äº«Inner-process Communicationå‘½åç©ºé—´ï¼Œå› æ­¤å¯ä»¥é€šè¿‡SystemVIPCæˆ–POSIXè¿›è¡Œ**è¿›ç¨‹é—´é€šä¿¡**
	- UTSå‘½åç©ºé—´ï¼šPodä¸­çš„å¤šä¸ªå®¹å™¨å…±äº«åŒä¸€ä¸ªä¸»æœºå
	- Volumesï¼šPodä¸­å„ä¸ªå®¹å™¨å¯ä»¥å…±äº«åœ¨Podä¸­å®šä¹‰åˆ†å­˜å‚¨å·ï¼ˆVolumeï¼‰

- restartPolicyå­—æ®µ
	- Alwaysï¼šåªè¦é€€å‡ºå°±é‡å¯
	- OnFailureï¼šå¤±è´¥é€€å‡ºæ—¶ï¼ˆexit codeä¸ä¸º0ï¼‰æ‰é‡å¯
		- ä¹Ÿå¯èƒ½æ˜¯æ­£å¸¸çš„é€€å‡º
	- Neverï¼šæ°¸è¿œä¸é‡å¯

### podç®¡ç†å‘½ä»¤

- **åˆ›å»ºpod**
	- `kubectl run`
	- `kubectl run myspittr --image spittr:1.0-SNAPSHOT`
	- ç±»ä¼¼docker run
- **æŸ¥çœ‹pod**
	- `kubectl get pods`
	- `kubectl logs -f myspittr`
- åœ¨podä¸­**æ‰§è¡Œå‘½ä»¤**
	- `kubectl exec`
	- `kubectl exec myspittr -- ls /run/secrets/kubernetes.io/serviceaccount`ï¼Œåœ¨myspitträ¸­æ‰§è¡Œ`--`åçš„å‘½ä»¤
- **åˆ é™¤pod**
	- `kubectl delete pod <pod name>`

### å¦‚ä½•å°†podæˆ–serviceçš„ç«¯å£å¿«é€Ÿæ˜ å°„åˆ°æœ¬æœºç«¯å£ï¼ˆè°ƒè¯•ç”¨ï¼‰

- **port-forward**: ``kubectl port-forward <name> host_ip:container_ip`
	- å’Œ`docker -p`ä¸€æ ·ï¼Œå·¦è¾¹å®¿ä¸»æœºå³è¾¹å®¹å™¨ç«¯å£
	- å¯ä»¥ç›´æ¥æ˜ å°„podï¼Œä½†æ›´**æ¨èæ˜ å°„service**

- æ˜ å°„podï¼š`kubectl port-forward pod/myspittr 8081:8080`
	 - è®¿é—®ï¼šhttp://localhost:8081/spittr/
 - æ˜ å°„serviceï¼š`kubectl port-forward service/demo 8081:80`

### Podã€Containerä¸Nodeä¹‹é—´çš„å…³ç³»

![image.png](https://chillcharlie-img.oss-cn-hangzhou.aliyuncs.com/image%2F2023%2F12%2F28%2F19-32-11-f9c84bf9f2d585a4e92d0a7a6a7fe85d-20231228193210-1d543b.png)

## Service

ä¸å¸Œæœ›è®©åˆ«äººç›´æ¥è®¿é—®podï¼Œk8så¯èƒ½ä¼šå¯¹podåšæ›´æ”¹ï¼Œipä¼šæ”¹å˜ã€‚ä½†**cluster-ipæˆ–æœåŠ¡åä¸ä¼šæ”¹å˜**ã€‚

### å‘½ä»¤

- åˆ›å»ºï¼škubectl expose
	- `kubectl expose pod <serveice name> --port <port>`

- æŸ¥çœ‹
	- kubectl svc

### å¦‚ä½•è®¿é—®Service

1. expose
2. port-forward
3. curlå®¹å™¨

## Ingress

### å‘½ä»¤

 - åˆ›å»ºï¼škubectl create ingress myspittr --class=nginx --rule=www.license.com/*=myspittr:8080
	 - è®¿é—®ï¼šhttp://www.license.com/spittr/
 - åˆ é™¤ï¼škubectl delete ingress myspittr


ingressç½‘å…³é»˜è®¤ç«¯å£80



