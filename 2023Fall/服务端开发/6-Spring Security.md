---
aliases: 
tags: 
categories:
sticky:
thumbnail:
cover: 
excerpt: false
mathjax: true
comment: true
title: 6-Spring Security
date:  Monday,October 16th 2023
modified:  Monday,October 16th 2023
---
- JAAS: Java Authentication Authorization Service. JDKæä¾›çš„è®¤è¯æˆæƒæœåŠ¡

`spring-boot-starter-security`

# Spring Security

- ä½œç”¨
	- é’ˆå¯¹å®¢æˆ·è¯·æ±‚æƒé™æ§åˆ¶
	- é’ˆå¯¹æ–¹æ³•çº§çš„æƒé™æ§åˆ¶

æ·»åŠ ä¾èµ–åä¼šè‡ªåŠ¨åŠ è½½å®‰å…¨ç›¸å…³çš„bean
# Cookie

- httpæ˜¯æ— çŠ¶æ€çš„åè®®ï¼Œcookieå¯ä»¥ä¿å­˜çŠ¶æ€
	- ä¾‹ï¼šä¿æŒç”¨æˆ·ç™»å½•çŠ¶æ€

ç”¨æˆ·ç™»å½•åï¼ŒæœåŠ¡ç«¯ä¼šè¿”å›session-idï¼Œä½œä¸ºcookieå­˜åœ¨æœ¬åœ°æ¯æ¬¡è¯·æ±‚éƒ½å¸¦ä¸Šcookie


# Webè¯·æ±‚æ‹¦æˆª

ä½¿ç”¨filter

![image.png](https://chillcharlie-img.oss-cn-hangzhou.aliyuncs.com/image%2F2023%2F10%2F26%2F092f577948a6053f598961fe1a329feb_20231026184400.png)

# å¼€å‘äººå‘˜è¦åšä»€ä¹ˆğŸ‘

é™¤äº†æ¡†æ¶æä¾›çš„ï¼Œå¼€å‘äººå‘˜è¿˜éœ€è¦åšä»€ä¹ˆ

1. å®ç°æ¥å£
	- è¢«Spring Securityè°ƒç”¨
	- `UserDetailInterface`æ¥å£ï¼šç»™Springæ¡†æ¶æä¾›ç”¨æˆ·è¯¦ç»†ä¿¡æ¯
2. å¯†ç åŠ å¯†/è§£å¯†å¯¹è±¡
3. (optional)å®ç°ç™»å½•é¡µé¢
	- æœ‰é»˜è®¤é¡µé¢
	- `/login`, Springå·²ç»è‡ªåŠ¨å®ç°äº†å¯¹åº”çš„`Controller`
4. æƒé™è®¾å®š  
	- `SecurityFilterChain`
	- ä»çˆ¶ç±»`WebSecurityConfigurerAdapter`å®ç°`configure`æ–¹æ³•

![image.png](https://chillcharlie-img.oss-cn-hangzhou.aliyuncs.com/image%2F2023%2F10%2F26%2F4875ccdece8ae8892f54cde6042a6fef_20231026184427.png)


- PasswordEncoderï¼š<font color="#ff0000">å¯†ç ä¸èƒ½æ˜æ–‡å­˜å‚¨</font>ï¼Œéœ€è¦åŠ å¯†åå†å­˜åˆ°æ•°æ®åº“é‡Œ
	- éœ€è¦å®šä¹‰`Bean`

# æ¡†æ¶å®ç°äº†ä»€ä¹ˆ

1. å®ç°ç”¨æˆ·ç™»å½•æ§åˆ¶å™¨get post
2. è¯·æ±‚é‡å®šå‘åˆ°ç”¨æˆ·ç™»å½•é¡µé¢
	- eg.ç”¨æˆ·æœªç™»å½•æ—¶ï¼Œè®¿é—®URLï¼ŒæœåŠ¡ç«¯é‡å®šå‘åˆ°ç™»å½•é¡µé¢
4. é€šè¿‡Filterå¯¹ç”¨æˆ·è®¾å®šçš„æƒé™è¿›è¡Œæƒé™æ§åˆ¶
# ç”¨æˆ·ä¿¡æ¯å­˜å‚¨ğŸ‘

- å†…å­˜ç”¨æˆ·æ•°æ®åº“
- JDBCç”¨æˆ·å­˜å‚¨
- LDAPç”¨æˆ·æ•°æ®åº“
	- è½»é‡çº§ç›®å½•æ•°æ®åº“

# æƒé™åˆ†ç±»

- Authorityï¼Œæƒé™
- Roleï¼Œè§’è‰²ï¼Œ===>>>æƒé™ï¼ŒåŠ å‰ç¼€ï¼šROLE_
# CSRF

- è·¨ç«™è¯·æ±‚ä¼ªé€ 
- é»˜è®¤å¼€å¯
- å¦‚ä½•å…³é—­ï¼š`.csrd().disable()`
- å¦‚ä½•å¿½ç•¥ï¼š`.ignoringAntMatchers("/admin/**")`

![image.png](https://chillcharlie-img.oss-cn-hangzhou.aliyuncs.com/image%2F2023%2F10%2F16%2F485966b40e6bb369ce1b793d15d48bf1_20231016205535.png)

- ä¾‹å­ï¼š
	1. Cè®¿é—®Aï¼Œç™»å½•ï¼Œå»ºç«‹é•¿æœŸä¼šè¯
	2. Cæ¯æ¬¡å¯¹Aè¯·æ±‚ï¼Œéƒ½ä¼šå¸¦æœ‰SessionID
	3. åœ¨æ­¤æœŸé—´Cåˆè®¿é—®äº†Bï¼Œå‡è®¾åˆä¸€ä¸ªè¡¨è¾¾
	4. Bè¿”å›è¡¨å•ï¼Œä½†æäº¤åœ°å€æ˜¯A
	5. ç”±äºæœ‰Cçš„SessionIDï¼Œæ‰€ä»¥Aè®¤ä¸ºæ˜¯åˆæ³•çš„

- è§£å†³ï¼šCæ¯æ¬¡æäº¤è¡¨å•Aï¼Œ\_csrf å­—æ®µæœ‰å”¯ä¸€IDï¼Œæ— æ³•ä¼ªé€ 

![image.png](https://chillcharlie-img.oss-cn-hangzhou.aliyuncs.com/image%2F2023%2F10%2F16%2F6a1a8a2f1ac8edf6f33638931d9d15b6_20231016210157.png)


# CORSï¼šè·¨åŸŸèµ„æºå…±äº«

- æ˜¯ç”±æµè§ˆå™¨å®šä¹‰çš„åè®®
	- æ˜¯ä¸€ç§åŸºäºÂ [HTTP](https://developer.mozilla.org/zh-CN/docs/Glossary/HTTP)Â å¤´çš„æœºåˆ¶ï¼Œè¯¥æœºåˆ¶é€šè¿‡å…è®¸æœåŠ¡å™¨æ ‡ç¤ºé™¤äº†å®ƒè‡ªå·±ä»¥å¤–çš„å…¶ä»–[æº](https://developer.mozilla.org/zh-CN/docs/Glossary/Origin)ï¼ˆåŸŸã€åè®®æˆ–ç«¯å£ï¼‰ï¼Œä½¿å¾—æµè§ˆå™¨å…è®¸è¿™äº›æºè®¿é—®åŠ è½½è‡ªå·±çš„èµ„æºã€‚è·¨æºèµ„æºå…±äº«è¿˜é€šè¿‡ä¸€ç§æœºåˆ¶æ¥æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦ä¼šå…è®¸è¦å‘é€çš„çœŸå®è¯·æ±‚ï¼Œè¯¥æœºåˆ¶é€šè¿‡æµè§ˆå™¨å‘èµ·ä¸€ä¸ªåˆ°æœåŠ¡å™¨æ‰˜ç®¡çš„è·¨æºèµ„æºçš„â€œé¢„æ£€â€è¯·æ±‚ã€‚åœ¨é¢„æ£€ä¸­ï¼Œæµè§ˆå™¨å‘é€çš„å¤´ä¸­æ ‡ç¤ºæœ‰ HTTP æ–¹æ³•å’ŒçœŸå®è¯·æ±‚ä¸­ä¼šç”¨åˆ°çš„å¤´ã€‚
- å¸¸ç”¨äºå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯åˆ†ç¦»çš„åœºæ™¯
	- ä¾‹ï¼šAæä¾›é™æ€é¡µé¢ï¼ŒBæä¾›Restæ¥å£


# Spring Securityæƒé™æ§åˆ¶

1. Javaé…ç½®ç±»æƒé™é…ç½®
	- é’ˆå¯¹ä»å®¢æˆ·ç«¯æ¥çš„httpè¯·æ±‚
2. æ–¹æ³•çº§åˆ«çš„æƒé™
	- é’ˆå¯¹ä¸šåŠ¡å±‚ä»£ç 
	- è°ƒç”¨å‰æ§åˆ¶ï¼Œè°ƒç”¨åæ§åˆ¶
	- ä¾‹ï¼šå¯¹æ•°æ®åº“deleteæ“ä½œåšæƒé™æ§åˆ¶

